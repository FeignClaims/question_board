************************************************************************************************************************
å‡½æ•°å‚æ•° (function parameter)
************************************************************************************************************************

æŒ‰ä¼ å€¼ã€ä¼ æŒ‡é’ˆã€ä¼ å¼•ç”¨æ¥åŒºåˆ†å‚æ•°æ˜¯æ²¡æœ‰æ„ä¹‰çš„, æˆ‘ä»¬æ›´åº”è¯¥è€ƒè™‘å‚æ•°çš„å®é™…ç”¨é€”: ä¸æ˜¯å»è€ƒè™‘æˆ‘ä»¬åº”è¯¥æ€æ ·ä¼ å‚, è€Œæ˜¯ **å»è€ƒè™‘æˆ‘ä»¬è¦ç”¨è¿™ä¸ªå‚æ•°åšä»€ä¹ˆ**.

å¯¹äºä¸€ä¸ªå˜é‡æˆ‘ä»¬å¯ä»¥è¿›è¡Œè¯»å–å’Œå†™å…¥, é‚£ä¹ˆå¯¹äºå‚æ•°ä¹Ÿæ˜¯å¦‚æ­¤:

è¾“å…¥å‚æ•° (in parameter): é€šè¿‡å‚æ•°ä¸ºå‡½æ•°è¾“å…¥å€¼.
  å‡½æ•°åªä»å®é™…å‚æ•°ä¸­è¯»å–ä¿¡æ¯, è€Œä¸ä¿®æ”¹å®é™…å‚æ•°çš„ä¿¡æ¯.

  .. code-block:: cpp
    :linenos:

    void function(int value) {
      value = value * 5;
      cout << value;  // è¾“å‡º 5
    }

    int main() {
      int value = 1;
      function(value);
      cout << value;  // è¾“å‡º 1
    }

è¾“å‡ºå‚æ•° (out parameter): é€šè¿‡å‚æ•°ä¸ºå‡½æ•°è¾“å‡ºå€¼.
  å‡½æ•°åªä¿®æ”¹å®é™…å‚æ•°çš„ä¿¡æ¯, è€Œä¸è¯»å–å®é™…å‚æ•°çš„ä»»ä½•ä¿¡æ¯.

  .. code-block:: cpp
    :linenos:

    void function(int& value) {
      value = 5;
    }

    int main() {
      int value = 1;
      function(value);
      cout << value;  // è¾“å‡º 5
    }

è¾“å…¥è¾“å‡ºå‚æ•° (in-out parameter): é€šè¿‡å‚æ•°ä¸ºå‡½æ•°è¾“å…¥å€¼, å¹¶è¾“å‡ºå€¼.
  å‡½æ•°æ—¢ä»å®é™…å‚æ•°ä¸­è¯»å–ä¿¡æ¯, åˆä¿®æ”¹å®é™…å‚æ•°çš„ä¿¡æ¯.

  .. code-block:: cpp
    :linenos:

    void function(int& value) {
      std::cout << value;  // è¾“å‡º 1
      value = 5;
    }

    int main() {
      int value = 1;
      function(value);
      cout << value;  // è¾“å‡º 5
    }

.. admonition:: ç›¸å…³ææ¡ˆ
  :class: coreguidelines

  - `D0708: å‚æ•°ä¼ é€’ - ä¿è¯ç»Ÿä¸€çš„åˆå§‹åŒ–å’Œå€¼è®¾ç½® <https://github.com/hsutter/708/blob/main/708.pdf>`_
  - :wg21:`P2668: åŸºäºç”¨é€”çš„å‚æ•°ä¼ é€’ <p2668>`

========================================================================================================================
ä¼ å‚å†³ç­–
========================================================================================================================

.. figure:: function_parameter.png

  C++98 ä¼ å‚å†³ç­–

.. admonition:: ç›¸å…³æ ¸å¿ƒå‡†åˆ™
  :class: coreguidelines

  - :coreguidelines:`F.15: å€¾å‘äºç®€å•å¸¸è§„çš„ä¼ é€’ä¿¡æ¯æ–¹å¼ <f15-prefer-simple-and-conventional-ways-of-passing-information>`
  - :coreguidelines:`F.16: å¯¹äºè¾“å…¥å‚æ•°, æŒ‰å€¼ä¼ é€’æ‹·è´å¼€é”€ä½çš„ç±»å‹, æŒ‰ const& ä¼ é€’å…¶ä»–ç±»å‹ <f16-for-in-parameters-pass-cheaply-copied-types-by-value-and-others-by-reference-to-const>`
  - :coreguidelines:`F.17: å¯¹äºè¾“å…¥è¾“å‡ºå‚æ•°, æŒ‰é const çš„ & ä¼ é€’ <f17-for-in-out-parameters-pass-by-reference-to-non-const>`
  - :coreguidelines:`F.20: å¯¹äºè¾“å‡ºå€¼, å€¾å‘äºä½¿ç”¨è¿”å›å€¼è€Œéè¾“å‡ºå‚æ•° <f20-for-out-output-values-prefer-return-values-to-output-parameters>`
  - :coreguidelines:`F.21: è¦è¾“å‡ºå¤šä¸ªå€¼, å€¾å‘äºè¿”å›ä¸€ä¸ªç»“æ„ä½“ <f21-to-return-multiple-out-values-prefer-returning-a-struct>`

------------------------------------------------------------------------------------------------------------------------
å†³ç­–ç”±æ¥: å¸¸è§ä¼ å‚æ–¹å¼çš„ç”¨é€”åˆ†æ
------------------------------------------------------------------------------------------------------------------------

æˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹è§è¿‡çš„ä¼ å‚æ–¹å¼, å¯¹å®ƒä»¬çš„ç”¨é€”è¿›è¡Œåˆ†ç±».

å…¶ä¸­ :cpp:`parameter` è¡¨ç¤ºå‚æ•°åˆ—è¡¨ä¸­çš„å½¢å¼å‚æ•°, :cpp:`argument` è¡¨ç¤ºè°ƒç”¨æ—¶ä¼ é€’çš„å®é™…å‚æ•°.

:cpp:`function(int parameter)`
  æŒ‰å€¼ä¼ å‚å‘ç”Ÿæ‹·è´, :cpp:`int parameter = argument` æ˜¯ä»å®é™…å‚æ•°æ‹·è´å¾—åˆ°çš„æ–°å¯¹è±¡, å› æ­¤è‡ªç„¶ä¸å¯èƒ½é€šè¿‡ :cpp:`parameter` ä¿®æ”¹ :cpp:`argument`, æ˜¯ **è¾“å…¥å‚æ•°**.

:cpp:`function(int& parameter)`
  æŒ‰å¼•ç”¨ä¼ å‚, :cpp:`int& parameter = argument` æ˜¯å¯¹å®é™…å‚æ•°çš„å¼•ç”¨, å¯¹ :cpp:`parameter` çš„ä»»ä½•æ“ä½œå…¶å®å°±æ˜¯å¯¹ :cpp:`argument` çš„æ“ä½œ, æ˜¯ **è¾“å‡ºå‚æ•°** (å¦‚æœåªå†™å…¥) æˆ– **è¾“å…¥è¾“å‡ºå‚æ•°** (æ—¢è¯»å–åˆå†™å…¥).

:cpp:`function(int const& parameter)`
  æŒ‰ const å¼•ç”¨ä¼ å‚, :cpp:`int const& parameter = argument` æ˜¯å¯¹å®é™…å‚æ•°çš„å¼•ç”¨, å¯¹ :cpp:`parameter` çš„ä»»ä½•æ“ä½œå…¶å®å°±æ˜¯å¯¹ :cpp:`argument` çš„æ“ä½œ, **ä½†è¿™ä¸ªå¼•ç”¨åªèƒ½ç”¨äºè¯»å–ä¸èƒ½ç”¨äºå†™å…¥**, æ˜¯ **è¾“å…¥å‚æ•°**.

:cpp:`function(int* parameter)`
  æŒ‰æŒ‡é’ˆä¼ å‚, :cpp:`int* parameter = &argument` æŒ‡å‘å®é™…å‚æ•°, å¯¹ :cpp:`*parameter` çš„ä»»ä½•æ“ä½œå…¶å®å°±æ˜¯å¯¹ :cpp:`argument` çš„æ“ä½œ, æ˜¯ **è¾“å‡ºå‚æ•°** (å¦‚æœåªå†™å…¥) æˆ– **è¾“å…¥è¾“å‡ºå‚æ•°** (æ—¢è¯»å–åˆå†™å…¥).

:cpp:`function(int const* parameter)`
  æŒ‰ const æŒ‡é’ˆä¼ å‚, :cpp:`int const* parameter = &argument` æŒ‡å‘å®é™…å‚æ•°, å¯¹ :cpp:`*parameter` çš„ä»»ä½•æ“ä½œå…¶å®å°±æ˜¯å¯¹ :cpp:`argument` çš„æ“ä½œ, **ä½†è¿™ä¸ªè§£å¼•ç”¨åªèƒ½ç”¨äºè¯»å–ä¸èƒ½ç”¨äºå†™å…¥**, æ˜¯ **è¾“å…¥å‚æ•°**.

------------------------------------------------------------------------------------------------------------------------
å†³ç­–ç”±æ¥: ä½¿ç”¨è¿”å›å€¼è€Œéè¾“å‡ºå‚æ•°
------------------------------------------------------------------------------------------------------------------------

è¾“å‡ºå‚æ•°æ–¹å¼å¹¶ä¸ç›´æ¥:

.. code-block:: cpp
  :linenos:

  void function(int& value) {
    value = 5;
  }

  /* ä¸­é—´éš”äº†å‡ ç™¾è¡Œä»£ç  */

  int main() {
    int value = 1;
    function(value);     // ä¼ å…¥å‚æ•°, åº”è¯¥ä¸ä¼šæ”¹å˜æˆ‘çš„ value, å¯¹ã€å¯¹å§?
    std::cout << value;  // è¾“å‡º 5ğŸ˜±
  }

ç›¸æ¯”äºè¾“å‡ºå‚æ•°, æˆ‘ä»¬æœ‰ä¸€ä¸ªæ›´å¥½çš„è¾“å‡ºæ–¹æ¡ˆâ€”â€”è¿”å›å€¼:

.. code-block:: cpp
  :linenos:

  int function() {
    return 5;
  }

  int main() {
    int value = function();
  }

å¦‚æœéœ€è¦è¿”å›å¤šä¸ªå€¼, ä½¿ç”¨ç»“æ„ä½“:

.. code-block:: cpp
  :linenos:

  struct Symmetric_minus_result {
    int lhs_minus_rhs;
    int rhs_minus_lhs;
  };

  Symmetric_minus_result symmetric_minus(int lhs, int rhs) {
    return {lhs - rhs, rhs - lhs};
  }

.. admonition:: ç›¸å…³æ ¸å¿ƒå‡†åˆ™
  :class: coreguidelines

  - `åœæ­¢ä½¿ç”¨è¾“å‡ºå‚æ•° <https://stlab.cc/tips/stop-using-out-arguments.html>`_
  - :coreguidelines:`F.20: å¯¹äºè¾“å‡ºå€¼, å€¾å‘äºä½¿ç”¨è¿”å›å€¼è€Œéè¾“å‡ºå‚æ•° <f20-for-out-output-values-prefer-return-values-to-output-parameters>`
  - :coreguidelines:`F.21: è¦è¾“å‡ºå¤šä¸ªå€¼, å€¾å‘äºè¿”å›ä¸€ä¸ªç»“æ„ä½“ <f21-to-return-multiple-out-values-prefer-returning-a-struct>`

========================================================================================================================
ä¼ å€¼? ä¼ æŒ‡é’ˆ?
========================================================================================================================

è¿™æ ·ä»¥å‚æ•°çš„å®é™…ç”¨é€”æ¥åˆ†æ, æ‰æ˜¯æœ€åæ˜ æˆ‘ä»¬ç¼–å†™ä»£ç çš„é€»è¾‘çš„, ä¹Ÿæ˜¯æœ€ç¬¦åˆäº‹å®çš„: ä¼ æŒ‡é’ˆå…¶å®ä¹Ÿæ˜¯ä¼ å€¼, ä¹‹æ‰€ä»¥åŒºåˆ«å¼€æ¥æ•™, å°±æ˜¯å†…å«äº†ç”¨å‚æ•°çš„å®é™…ç”¨é€”æ¥åŒºåˆ«çš„æƒ³æ³•.

ä»¥ :cpp:`by_value(int value)` å’Œ :cpp:`by_pointer(int* pointer)` ä¸ºä¾‹.

:cpp:`by_value(int value)` è°ƒç”¨æ—¶, æ‹·è´çš„æ˜¯ :cpp:`int` ç±»å‹; è€Œ :cpp:`by_pointer(int* pointer)` è°ƒç”¨æ—¶, æ‹·è´çš„æ˜¯ :cpp:`int*` ç±»å‹.

åœ¨ :doc:`/faq/basic_concepts/pointer` ä¸­å·²æŒ‡å‡º, æŒ‡é’ˆæ˜¯ä¸€ä¸ªå¯¹è±¡, å®ƒå­˜å‚¨äº†æŒ‡å‘å¯¹è±¡çš„åœ°å€, è‡ªç„¶æ‹·è´å¾—åˆ°çš„æ–°æŒ‡é’ˆä¹Ÿå­˜å‚¨äº†é‚£ä¸ªåœ°å€. å› æ­¤è‡ªç„¶åœ°, è¿™ä¸ªæ–°æŒ‡é’ˆè§£å¼•ç”¨ä¹Ÿèƒ½è®¿é—®é‚£ä¸ªæŒ‡å‘çš„å¯¹è±¡:

.. code-block:: cpp
  :linenos:

  int temp = 5;

  void function(int* pointer) {
    pointer = &temp;  // pointer æŒ‡å‘ temp
  }

  int main() {
    int value    = 0;
    int* pointer = &value;  // &value å–åœ°å€, å¾—åˆ°æŒ‡å‘ value çš„ä¸€ä¸ªæŒ‡é’ˆ

    function(pointer);      // è°ƒç”¨æ—¶è¿™ä¸ªæŒ‡é’ˆä¹Ÿæ˜¯ä¼ å€¼, å‘ç”Ÿæ‹·è´, åªæ˜¯æ‹·è´å¾—åˆ°çš„æŒ‡é’ˆä¹ŸæŒ‡å‘ value

    std::cout << *pointer;  // è¾“å‡º 0, å®ƒä¾ç„¶æŒ‡å‘ value!
  }

========================================================================================================================
ç›¸å…³è§£ç­”
========================================================================================================================

- :doc:`/faq/copy_functions_parameter/index`
