************************************************************************************************************************
å®ä¾‹åˆ†æ: åŠ¨æ€æ•°ç»„ (dynamic array)
************************************************************************************************************************

.. admonition:: å‰ç½®å†…å®¹
  :class: precontent

  - :doc:`/faq/basic_concepts/object`
  - :doc:`/faq/basic_concepts/initialization_assignment`
  - :doc:`/faq/basic_concepts/resource`
  - :doc:`/faq/basic_concepts/struct`
  - :doc:`/faq/basic_concepts/pointer`
  - :doc:`/faq/basic_concepts/c_array`

========================================================================================================================
åŠ¨æ€æ•°ç»„çš„åˆ†é…å’Œé‡Šæ”¾
========================================================================================================================

å†…ç½®æ•°ç»„ :cpp:`int array[size]` çš„é•¿åº¦ :cpp:`size` å¿…é¡»åœ¨ç¼–è¯‘æ—¶å·²çŸ¥, è€Œä¸èƒ½ç­‰åˆ°ç¨‹åºè¿è¡Œæ—¶æ‰ç¡®å®š.

.. tabs::

  .. tab:: æ•´æ•°å­—é¢å€¼

    .. code-block:: cpp
      :linenos:

      int array[100];  // æ˜¾ç„¶åœ¨ç¼–è¯‘æ—¶å°±çŸ¥é“æ˜¯ 100

  .. tab:: :cpp:`const` å˜é‡

    .. code-block:: cpp
      :linenos:

      int const size = 100;
      int array[size];  // ç¼–è¯‘æ—¶å°±çŸ¥é“ size æ˜¯ 100, ä¸å¯æ”¹å˜

  .. tab:: å˜é‡

    .. code-block:: cpp
      :linenos:

      int size = 0;
      std::cin >> size
      int array[size];  // é”™è¯¯: ç¨‹åºè¿è¡Œå¹¶è¿›è¡Œè¾“å…¥å, æ‰èƒ½çŸ¥é“ size çš„å€¼

è¿™æ˜¯å› ä¸º :doc:`è°ƒç”¨å‡½æ•°å°†ä¼šåœ¨æ ˆä¸Šåˆ›å»ºæ ˆå¸§æ¥è®°å½•æ•°æ® </faq/basic_concepts/function>`, æ ˆå¸§å­˜å‚¨äº†æœ¬æ¬¡è°ƒç”¨çš„å‚æ•°ã€å±€éƒ¨å˜é‡ç­‰, æŒ‰è®¾è®¡å¾€å¾€å¤§å°æ˜¯å›ºå®šçš„, å› æ­¤éœ€è¦åœ¨ç¼–è¯‘æ—¶å°±èƒ½ç¡®å®šå±€éƒ¨å˜é‡çš„å¤§å°.

ä½†æˆ‘ä»¬æœ‰æ ¹æ®è¿è¡Œæƒ…å†µæ¥ç¡®å®šæ•°ç»„é•¿åº¦çš„éœ€æ±‚. æ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨ :cpp:`new[]` åœ¨å †ç©ºé—´ä¸Š (è€Œéæ ˆä¸Š) åˆ†é…ç©ºé—´, æ ˆå¸§ä¸Šä»…å­˜å‚¨ :cpp:`new[]` æ‰€è¿”å›çš„æŒ‡é’ˆ, ç”¨è¿™ä¸ªæŒ‡é’ˆæ¥æ“ä½œæ•´ä¸ªæ•°ç»„:

.. code-block:: cpp
  :linenos:

  int main() {
    int size = 0;
    std::cin >> size;

    // â†“ å±€éƒ¨å˜é‡â€”â€”ä¹Ÿå°±æ˜¯æ ˆä¸Šâ€”â€”åªæ˜¯è¿™ä¸€ä¸ªæŒ‡é’ˆ
    int* array = new int[size];
    array[0]   = 0;
    array[1]   = 1;
    array[2]   = 2;
  }

æˆ‘ä»¬å¯ä»¥åœ¨ :cpp:`new[]` æ—¶, ç›´æ¥åˆå§‹åŒ–è¿™ä¸ªæ•°ç»„:

.. code-block:: cpp
  :linenos:

  int main() {
    int size = 0;
    std::cin >> size;

    // åˆå§‹åŒ–ä¸º {0, 1, 2, ä¹‹åçš„éƒ½ä¸º 0}
    int* array0 = new int[size]{0, 1, 2};

    // åˆå§‹åŒ–æ‰€æœ‰å…ƒç´ ä¸º 0
    int* array1 = new int[size]{};
  }

ç”±äºæˆ‘ä»¬ä¸å†å°†æ•°ç»„åˆ†é…åœ¨æ ˆå¸§å†…, å½“å‡½æ•°è°ƒç”¨ç»“æŸã€æ ˆå¸§è¢«é‡Šæ”¾æ—¶, éšæ ˆå¸§é‡Šæ”¾çš„åªæœ‰æ ˆå¸§ä¸Šçš„æŒ‡é’ˆ, è€Œæ•°ç»„ä¾ç„¶å­˜åœ¨, æ‰€ä»¥æˆ‘ä»¬éœ€è¦æ‰‹åŠ¨è°ƒç”¨ :cpp:`delete[]` é‡Šæ”¾å®ƒ:

.. code-block:: cpp
  :linenos:

  int main() {
    int size = 0;
    std::cin >> size;

    int* array = new int[size]{};

    delete[] array;
  }

åè¿‡æ¥è¯´, åªè¦æˆ‘ä»¬å…·æœ‰æŒ‡å‘è¯¥æ•°ç»„çš„æŒ‡é’ˆ, ä¸”è¯¥æ•°ç»„è¿˜æ²¡è¢«é‡Šæ”¾, å°±èƒ½ç›´æ¥ä½¿ç”¨è¯¥æ•°ç»„:

.. code-block:: cpp
  :linenos:

  int* make_array(int size) {
    int* array = new int[size]{};
    return array;
  }

  int main() {
    int* array0 = make_array(5);   // è·å¾—ä¸€ä¸ªé•¿åº¦ä¸º 5 çš„æ•°ç»„
    int* array1 = make_array(10);  // è·å¾—ä¸€ä¸ªé•¿åº¦ä¸º 10 çš„æ•°ç»„

    delete[] array0;
    delete[] array1;
  }

========================================================================================================================
åŠ¨æ€æ•°ç»„çš„åŸºæœ¬æ“ä½œ
========================================================================================================================

:doc:`C é£æ ¼æ•°ç»„å¾ˆå®¹æ˜“éšå¼ç±»å‹è½¬æ¢ä¸ºé¦–å…ƒç´ çš„æŒ‡é’ˆ </faq/basic_concepts/c_array>`, è€Œæˆ‘ä»¬ç”¨ :cpp:`new[]` è¯·æ±‚åŠ¨æ€æ•°ç»„è¿”å›çš„ä¹Ÿæ˜¯æŒ‡é’ˆ, æ‰€ä»¥åŠ¨æ€æ•°ç»„çš„æ“ä½œé™¤äº†éœ€è¦æ‰‹åŠ¨é‡Šæ”¾, å…¶ä»–éƒ¨åˆ†ä¸æ­£å¸¸æ•°ç»„å…¶å®å¹¶æ— å·®å¼‚: :godbolt:`jzjnv1vrz`

.. code-block:: cpp
  :linenos:
  :caption: å¡«å……

  void fill_n(int* array, int size, int value) {
    for (int i = 0; i < size; ++i) {
      array[i] = value;
    }
  }

  int main() {
    int* array = new int[100]{};
    fill_n(array, 100, 5);
  }

.. code-block:: cpp
  :linenos:
  :caption: è¾“å‡º

  void print(int const* array, int size) {
    for (int i = 0; i < size; ++i) {
      std::cout << array[i] << ' ';
    }
    std::cout << '\n';
  }

  int main() {
    int* array = new int[100]{};
    print(array, 100);
  }

========================================================================================================================
è®©åŠ¨æ€æ•°ç»„åƒ :cpp:`int` ä¸€æ ·
========================================================================================================================

------------------------------------------------------------------------------------------------------------------------
ç›´æ¥ä½¿ç”¨ :cpp:`new[]` å’Œ :cpp:`delete[]` çš„é—®é¢˜
------------------------------------------------------------------------------------------------------------------------

ç›®å‰æˆ‘ä»¬å·²ç»å»ºç«‹äº†åŠ¨æ€æ•°ç»„, ä½†è¿™çœŸçš„å¥½ç”¨å—?

æˆ‘ä»¬éœ€è¦æ‰‹åŠ¨è°ƒç”¨ :cpp:`delete[]` æ¥é‡Šæ”¾èµ„æº.
  .. code-block:: cpp
    :linenos:

    int main() {
      int* array = new int[1000];
    }  // æ²¡æœ‰ delete[] è€Œå†…å­˜æ³„éœ², ä½ å¯èƒ½å¯¼è‡´å‘åŠ¨æœºåœæ­¢, å¼•å‘äº†ä¸€åœºç©ºéš¾!

æˆ‘ä»¬æ‹·è´æ‰€å¾—æ–°æŒ‡é’ˆä»ç„¶æŒ‡å‘åŒä¸€æ•°ç»„.
  .. code-block:: cpp
    :linenos:

    int main() {
      int* array0 = new int[3];
      fill_n(array0, 3, 5);
      print(array0, 3);  // array0: {5, 5, 5}

      int* array1 = array0;
      fill_n(array1, 3, 7);  // å¯¹ array1 å¡«å……åº”è¯¥ä¸å½±å“ array0, å¯¹ã€å¯¹å§?

      print(array0, 3);  // array0: {7, 7, 7}ğŸ˜±
    }

é•¿åº¦å’Œæ•°ç»„æœ¬èº«ç›¸åˆ†ç¦».
  .. code-block:: cpp
    :linenos:

    int main() {
      int size   = 10;
      int* array = new int[10];

      print(array, size);  // æ—¢è¦ä¼ é¦–å…ƒç´ æŒ‡é’ˆ, è¿˜è¦ä¼ é•¿åº¦!

      size = 20;  // size == 20, å¯æ˜¯æ•°ç»„é•¿åº¦è¿˜æ˜¯ 10!
    }

æ¥ä¸‹æ¥æˆ‘ä»¬è®¾è®¡åŠ¨æ€æ•°ç»„ç±»æ¥è¿›è¡Œèµ„æºç®¡ç†, è®©åŠ¨æ€æ•°ç»„çš„ä½¿ç”¨è·Ÿ :cpp:`int` å·®ä¸å¤š:

- ææ„æ—¶å°±é‡Šæ”¾èµ„æº, ä¸éœ€è¦æ‰‹åŠ¨è°ƒç”¨ :cpp:`delete[]`.
- æ‹·è´å¾—åˆ°çš„æ–°å¯¹è±¡ä¸åŸå¯¹è±¡ç›¸äº’ç‹¬ç«‹, å¯¹ä¸€ä¸ªå¯¹è±¡æ“ä½œä¸ä¼šå½±å“å¦ä¸€ä¸ªå¯¹è±¡.
- æ•°ç»„æœ¬èº«å’Œå…¶é•¿åº¦è¢«å­˜å‚¨ä¸ºä¸€ä¸ªå¯¹è±¡çš„æˆå‘˜, å®ƒä»¬ä¹‹é—´çš„ä¸å˜å¼å³é€»è¾‘å…³ç³»å¯¹å¤–å§‹ç»ˆæˆç«‹.

ä½†åœ¨è®¾è®¡ä¹‹å‰, æˆ‘ä»¬å…ˆåˆ†ç¦»ä¸€äº›ç»†èŠ‚, å¹¶å¼•å…¥ä¸€äº›åŸºæœ¬ç»„ä»¶.

.. seealso::

  - :doc:`/faq/class_invariant/main`

------------------------------------------------------------------------------------------------------------------------
å…³æ³¨é€»è¾‘ã€å¿½ç•¥æ•°æ®
------------------------------------------------------------------------------------------------------------------------

åŠ¨æ€æ•°ç»„å­˜å‚¨ä»€ä¹ˆç±»å‹çš„å€¼è·Ÿæˆ‘ä»¬è®¾è®¡åŠ¨æ€æ•°ç»„æ²¡å¤šå¤§å…³ç³», æ‰€ä»¥æˆ‘ä»¬é¦–å…ˆå¯¹æ•°æ®çš„å­˜å‚¨è¿›è¡ŒæŠ½è±¡, ç”¨ç±»å‹åˆ«åæ¥æ›¿ä»£å­˜å‚¨çš„æ•°æ®:

.. code-block:: cpp
  :linenos:
  :caption: ç±»å‹åˆ«å

  using value_type = int;  // value_type æ˜¯ int çš„åˆ«å

  value_type value = 0;  // ç›¸å½“äº int value = 0;
  value_type array[5];   // ç›¸å½“äº int array[5];

å› æ­¤, æˆ‘ä»¬çš„åŠ¨æ€æ•°ç»„ç±»åº”è¯¥å†™ä¸º:

.. code-block:: cpp
  :linenos:

  using value_type = int;

  class Dynamic_array {
   public:
    /* ... */

   private:
    int size_;
    value_type* data_;
  };

------------------------------------------------------------------------------------------------------------------------
å®ç°åŠ¨æ€æ•°ç»„çš„é‡è¦ç»„ä»¶
------------------------------------------------------------------------------------------------------------------------

æ ‡å‡†åº“ä¸­æœ‰å¾ˆå¤šè¢«æ•™å­¦å¿½ç•¥äº†çš„ç®—æ³•å’Œç®—æ³•åŸºç¡€ç»„ä»¶, å®é™…ä¸Šå¾ˆå¤šä»£ç æ˜¯æ²¡å¿…è¦è‡ªå·±ç¼–å†™çš„, è‡ªè¡Œåœ¨ç®—æ³•å†…ç¼–å†™ä¸ä»…ä½æ•ˆè€Œä¸”å½±å“é˜…è¯».

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
:cpp:`std::swap`
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

ä¸€ä¸ªé‡è¦çš„ç»„ä»¶æ˜¯, å°† :cpp:`lhs` (left hand side) å’Œ :cpp:`rhs` å˜é‡çš„å†…å®¹è¿›è¡Œäº¤æ¢, è¯¾ä¸Šå¯èƒ½ä¼šå†™ä¸º:

.. code-block:: cpp
  :linenos:

  int lhs = 2;
  int rhs = 3;

  int temp = lhs;
  lhs      = rhs;
  rhs      = temp;

  std::cout << lhs;  // è¾“å‡º 3
  std::cout << rhs;  // è¾“å‡º 2

ä¸, ä½ æ²¡æœ‰è‡ªå·±å†™çš„å¿…è¦:

.. code-block:: cpp
  :linenos:

  #include <utility>  // for std::swap

  int lhs = 2;
  int rhs = 3;
  std::swap(lhs, rhs);
  std::cout << lhs;  // è¾“å‡º 3
  std::cout << rhs;  // è¾“å‡º 2

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
:cpp:`std::copy_n`
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

å›å¿†ä¸€ä¸‹, ä½ æœ‰å¤šå°‘æ¬¡ç¼–å†™æ‹·è´æ•´ä¸ªæ•°ç»„äº†?

.. tabs::

  .. tab:: :cpp:`strcpy`

    .. code-block:: cpp
      :linenos:

      #include <cstring>  // for std::strcpy

      char const* input = "hello world";
      int output[100]   = {};

      std::strcpy(output, input);

      std::cout << output;  // è¾“å‡º "hello world"

  .. tab:: æ‰‹å†™ :cpp:`int` æ•°ç»„æ‹·è´

    .. code-block:: cpp
      :linenos:

      int input[10]  = {5, 4, 2, 7};
      int output[20] = {};

      // æ‹·è´ [input, input + 10) åˆ° [output, output + 10)
      for (int i = 0; i < 10; ++i) {
        output[i] = input[i];
      }

:cpp:`<algorithm>` ä¸­æœ‰ä¸Šç™¾ç§ç®—æ³•, è€Œ :cpp:`std::copy_n` å°±æ˜¯å…¶ä¸­ä¸€ä¸ª.

ç›¸æ¯”äº :cpp:`std::strcpy(output, input)` åªèƒ½ç”¨äºå­—ç¬¦ä¸²æ‹·è´, :cpp:`std::copy_n(input, size, output)` èƒ½ç”¨äºä»»ä½•ç±»å‹:

.. tabs::

  .. tab:: æ‹·è´ :cpp:`int` æ•°ç»„

    .. code-block:: cpp
      :linenos:

      #include <algorithm>  // for std::copy_n

      int input[10]  = {5, 4, 2, 7};
      int output[20] = {};

      // æ‹·è´ [input, input + 10) åˆ° [output, output + 10)
      std::copy_n(input, 10, output);

  .. tab:: æ‹·è´ :cpp:`char` æ•°ç»„

    .. code-block:: cpp
      :linenos:

      #include <algorithm>  // for std::copy_n

      char const* input = "hello world";
      int output[100]   = {};

      // é•¿åº¦ä¸º std::strlen(input) + 1, å› ä¸ºè¿˜è¦æ‹·è´ç»ˆæ­¢å­—ç¬¦
      std::copy_n(input, std::strlen(input) + 1, output);

      std::cout << output;  // è¾“å‡º "hello world"

ä½ å¯ä»¥è‡ªå·±å®ç° :cpp:`std::copy_n` çš„ç®€å•ç‰ˆæœ¬: :godbolt:`55d95cbo5`

.. code-block:: cpp
  :linenos:

  using value_type = int;

  // å°† [input, input + size) ä»å·¦åˆ°å³æ‹·è´åˆ° [output, output + size) ä¸­
  //
  // è¿”å›å€¼::
  //   è¿”å› output + size, å³å¦‚æœç»§ç»­å¯¹ output è¿›è¡Œæ‹·è´, åº”è¯¥ä½¿ç”¨çš„æŒ‡é’ˆ.
  value_type* copy_n(value_type const* input, int size, value_type* output) {
    for (int i = 0; i < size; ++i) {
      output[i] = input[i];
    }
    return output + size;
  }

è¯·æ³¨æ„ :cpp:`copy_n` æœ‰ä¸€ä¸ªè¿”å›å€¼, ä¹‹åä½ å°†ä¼šçœ‹åˆ°å®ƒçš„é­…åŠ›.

------------------------------------------------------------------------------------------------------------------------
èµ„æºçš„è·å–ä¸é‡Šæ”¾
------------------------------------------------------------------------------------------------------------------------

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
å®šä¹‰æ„é€ å‡½æ•°å’Œææ„å‡½æ•°
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

ç›¸æ¯”äºä¹‹å‰æ‰‹åŠ¨è°ƒç”¨ :cpp:`new[]` å’Œ :cpp:`delete[]`, æˆ‘ä»¬åœ¨ç±»ä¸­å®šä¹‰æ„é€ å‡½æ•°æ¥è·å–èµ„æº, å®šä¹‰ææ„å‡½æ•°æ¥é‡Šæ”¾èµ„æº:

.. code-block:: cpp
  :linenos:

  using value_type = int;

  class Dynamic_array {
   public:
    Dynamic_array() {
      size_ = 0;
      data_ = nullptr;
    }

    Dynamic_array(int size) {
      size_ = size;
      data_ = size == 0 ? nullptr : new value_type[size];
    }

    ~Dynamic_array() {
      // â†“ delete[] æœ¬èº«è‡ªå¸¦å¯¹ç©ºæŒ‡é’ˆçš„æ£€æŸ¥, ä¸éœ€è¦æå‰åˆ¤æ–­ data_ == nullptr
      delete[] data_;
    }

   private:
    int size_;
    value_type* data_;
  };

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
ç”¨é»˜è®¤å‚æ•°åˆå¹¶æ„é€ æƒ…å†µ
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

å¾ˆæ˜æ˜¾, é»˜è®¤æ„é€  :cpp:`Dynamic_array()` ä¸è¿‡æ˜¯ :cpp:`Dynamic_array(int size)` ä¸­ :cpp:`size == 0` çš„æƒ…å†µ, å› æ­¤æˆ‘ä»¬åˆå¹¶ä¸º :cpp:`Dynamic_array(int size = 0)`, å³å½“ä¸æä¾› :cpp:`size` å‚æ•°æ—¶, é»˜è®¤ :cpp:`size` ä¸º :cpp:`0`:

.. code-block:: cpp
  :linenos:

  class Dynamic_array {
   public:
    Dynamic_array(int size = 0) {
      size_ = size;
      data_ = size == 0 ? nullptr : new value_type[size];
    }

    /* ... */

   private:
    int size_;
    value_type* data_;
  };

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
ç”¨æˆå‘˜åˆå§‹åŒ–å™¨å¯¹æˆå‘˜è¿›è¡Œåˆå§‹åŒ–è€Œéèµ‹å€¼
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

ä½†è¿è¡Œåˆ°æ„é€ å‡½æ•°ä½“å†…æ—¶, æ‰€æœ‰æˆå‘˜å…¶å®å·²ç»æ„é€ å¥½äº†, æˆ‘ä»¬ :cpp:`size_ = size` ä¸æ˜¯åœ¨æ„é€ æ—¶åˆå§‹åŒ–æˆå‘˜, åªæ˜¯åœ¨å¯¹å·²ç»æ„é€ çš„æˆå‘˜è¿›è¡Œèµ‹å€¼: å¦‚æœæŠŠæ„é€ æ—¶åˆå§‹åŒ–æ¯”å–»ä¸ºä¿®å»ºæˆ¿å±‹, èµ‹å€¼å°±æ˜¯ä½ å·²ç»ä½äº†ä¸€æ®µæ—¶é—´åå†å¯¹æˆ¿å­è¿›è¡Œè£…ä¿®.

ä¸ºäº†åœ¨æˆå‘˜æ„é€ è¿›è¡Œåˆå§‹åŒ–, æˆ‘ä»¬åœ¨å‡½æ•°ä½“ä¹‹å‰ä½¿ç”¨æˆå‘˜åˆå§‹åŒ–å™¨:

.. code-block:: cpp
  :linenos:

  class Dynamic_array {
   public:
    Dynamic_array(int size = 0)
        : size_(size), data_(size == 0 ? nullptr : new value_type[size]()) {}

    /* ... */

   private:
    int size_;
    value_type* data_;
  };

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
ç”¨ :cpp:`explicit` é¿å…éšå¼ç±»å‹è½¬æ¢
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

è¿™æ ·å°±å¤Ÿäº†å—? è®©æˆ‘ä»¬çœ‹ä¸¤æ®µä»£ç :

.. code-block:: cpp
  :linenos:
  :caption: å¥‡æ€ªçš„æ„é€ 

  int main() {
    Dynamic_array array = 5;  // 5 é€šè¿‡ Dynamic_array(int) è½¬æ¢ä¸º Dynamic_array
  }

.. code-block:: cpp
  :linenos:
  :caption: å¥‡æ€ªçš„ä¼ å‚

  void function(Dynamic_array array) {
    /* ... */
  }

  int main() {
    int value = 0;
    /* ... */
    function(value);  // value é€šè¿‡ Dynamic_array(int) è½¬æ¢ä¸º Dynamic_array
  }

æ‰€ä»¥å¯¹äºèƒ½è¢«å•ä¸ªå‚æ•°è°ƒç”¨çš„æ„é€ å‡½æ•°, æˆ‘ä»¬åº”è¯¥ç”¨ :cpp:`explicit` è¦æ±‚å®ƒåªèƒ½è¢«æ˜¾å¼è°ƒç”¨:

.. code-block:: cpp
  :linenos:

  class Dynamic_array {
   public:
    explicit Dynamic_array(int size = 0)
        : size_(size), data_(size == 0 ? nullptr : new value_type[size]()) {}

    /* ... */

   private:
    int size_;
    value_type* data_;
  };

æœ€ç»ˆå¾—åˆ°: :godbolt:`d1YqvP19W`

.. code-block:: cpp
  :linenos:

  /* ... */

  int main() {
    // Dynamic_array array0 = 5;  // é”™è¯¯: ä¸èƒ½ä» int è½¬æ¢ä¸º Dynamic_array
    Dynamic_array array(5);
  }  // ææ„æ—¶è°ƒç”¨ææ„å‡½æ•°, è‡ªåŠ¨é‡Šæ”¾æ•°ç»„

------------------------------------------------------------------------------------------------------------------------
è®¿é—®æ•°ç»„ç›¸å…³ä¿¡æ¯
------------------------------------------------------------------------------------------------------------------------

æˆ‘ä»¬æ¥ä¸‹æ¥å®šä¹‰å…¬ç”¨æˆå‘˜å‡½æ•°, å‘ŠçŸ¥ä½¿ç”¨è€…å¯ä»¥å¦‚ä½•è®¿é—®è¿™ä¸ªæ•°ç»„. å…·ä½“åœ°, æˆ‘ä»¬å¸Œæœ›ä½¿ç”¨è€…èƒ½å†™å‡ºè¿™æ ·çš„ä»£ç :

.. code-block:: cpp
  :linenos:

  void fill(Dynamic_array& array, int value) {
    for (int i = 0; i < array.size(); ++i) {
      array[i] = value;
    }
  }

  void print(Dynamic_array const& array) {
    for (int i = 0; i < array.size(); ++i) {
      std::cout << array[i] << ' ';
    }
    std::cout << '\n';
  }

é‚£ä¹ˆæˆ‘ä»¬éœ€è¦å®šä¹‰:

- å¦‚ä½•è¿›è¡Œä¸‹æ ‡è®¿é—®, å³å®ç° :cpp:`operator[](int index)` æˆå‘˜å‡½æ•° (è¿ç®—ç¬¦æ˜¯ :cpp:`[]`, å‚æ•°æ˜¯ :cpp:`int index`).
- å¦‚ä½•æŸ¥è¯¢æ•°ç»„é•¿åº¦, å³å®ç° :cpp:`size()` æˆå‘˜å‡½æ•°.

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
æ”¯æŒ :cpp:`fill` å‡½æ•°
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

:cpp:`size()` å¾ˆå®¹æ˜“å®ç°, è€Œå¯¹äºä¸‹æ ‡è®¿é—®æ“ä½œ, å®ƒé™¤äº†å‡½æ•°åå­—å˜æˆäº† :cpp:`operator[]` ä»¥å¤–, å…¶ä½™çš„ä¸æ­£å¸¸å‡½æ•°æ²¡æœ‰ä»€ä¹ˆåŒºåˆ«.

ç”±äº :cpp:`fill` éœ€è¦é€šè¿‡ä¸‹æ ‡è®¿é—®ä¿®æ”¹æ•°ç»„å…ƒç´ çš„å†…å®¹, ä¸‹æ ‡è®¿é—®åº”è¯¥è¿”å›å¯¹å…ƒç´ çš„å¼•ç”¨: :godbolt:`Y9Tddv3MM`

.. code-block:: cpp
  :linenos:

  class Dynamic_array {
   public:
    /* ... */

    value_type& operator[](int index) {
      return data_[index];
    }

    int size() {
      return size_;
    }

   private:
    int size_;
    value_type* data_;
  };

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
æ”¯æŒ :cpp:`print` å‡½æ•°
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

:cpp:`print` å‡½æ•°åªæ˜¯ç”¨äºè¾“å‡º, å› è€Œä¸åº”è¯¥èƒ½ä¿®æ”¹ :cpp:`Dynamic_array` çš„å†…å®¹â€”â€”æˆ‘ä»¬æŒ‰ :cpp:`Dynamic_array const&` ä¼ é€’å‚æ•°:

.. code-block:: cpp
  :linenos:

  void print(Dynamic_array const& array) {
    for (int i = 0; i < array.size(); ++i) {  // é”™è¯¯: size() ä¸æ˜¯ const å‡½æ•°
      std::cout << array[i] << ' ';           // é”™è¯¯: ä¸‹æ ‡è®¿é—®ä¸æ˜¯ const å‡½æ•°
    }
    std::cout << '\n';
  }

ä¸ºä»€ä¹ˆæŠ¥é”™äº†? æˆ‘ä»¬æ²¡æœ‰æŒ‡å‡º :cpp:`size()` å’Œ :cpp:`operator[]` ä¿è¯ä¸ä¼šä¿®æ”¹å¯¹è±¡, å› è€Œä¸èƒ½å¯¹ const å¯¹è±¡è°ƒç”¨å®ƒä»¬.

å¥½å§, :cpp:`size()` åªæ˜¯è·å–é•¿åº¦, å¿…ç„¶ä¸ä¼šä¿®æ”¹å¯¹è±¡, æˆ‘ä»¬æ¥æ ‡è¯†ä¸€ä¸‹:

.. code-block:: cpp
  :linenos:

  class Dynamic_array {
   public:
    //         â†“ æˆ‘ä¿è¯è¿™ä¸ªå‡½æ•°ä¸ä¼šä¿®æ”¹å¯¹è±¡
    int size() const {
      return size_;
    }

    /* ... */
  }

ä½†æ˜¯ä¸‹æ ‡è®¿é—®å‘¢?

- å¯¹äºé const å¯¹è±¡, æˆ‘ä»¬è¦å…è®¸é€šè¿‡ä¸‹æ ‡è®¿é—®ä¿®æ”¹æ•°æ®;
- å¯¹äº const å¯¹è±¡, æˆ‘ä»¬è¦ä¿è¯ä¸èƒ½é€šè¿‡ä¸‹æ ‡è®¿é—®ä¿®æ”¹æ•°æ®.

å…¶å®å¾ˆç®€å•, æˆ‘ä»¬å†™ä¸€ä¸ªé const ç‰ˆæœ¬çš„å‡½æ•°å’Œä¸€ä¸ª const ç‰ˆæœ¬çš„å‡½æ•°:

.. code-block:: cpp
  :linenos:

  class Dynamic_array {
   public:
    value_type& operator[](int index) {
      return data_[index];
    }

    // â†“ è¿”å› value const&, è‡ªç„¶ä¸èƒ½è¿›è¡Œä¿®æ”¹äº†
    value_type const& operator[](int index) const {
      return data_[index];
    }

    /* ... */
  }

æœ€ç»ˆå¾—åˆ°: :godbolt:`97c5cf7c1`

.. code-block:: cpp
  :linenos:

  class Dynamic_array {
   public:
    value_type& operator[](int index) {
      return data_[index];
    }

    value_type const& operator[](int index) const {
      return data_[index];
    }

    int size() const {
      return size_;
    }
  };

.. seealso::

  - :doc:`/faq/east_const/main` ä¸­è§£é‡Šäº†ä¸ºä»€ä¹ˆ const æˆå‘˜å‡½æ•°æ˜¯å°† :cpp:`const` æ˜¯æ”¾åœ¨å³è¾¹.

------------------------------------------------------------------------------------------------------------------------
æ‹·è´å‡½æ•°
------------------------------------------------------------------------------------------------------------------------

æ³¨æ„åˆ°åœ¨ä¹‹å‰çš„ :cpp:`fill(Dynamic_array&, int)` å’Œ :cpp:`print(Dynamic_array const&)` å‡½æ•°ä¸­, æˆ‘ä»¬éƒ½ä½¿ç”¨çš„æ˜¯å¼•ç”¨ä¼ å‚è€ŒéæŒ‰å€¼ä¼ å‚ (æ‹·è´ä¼ å‚).

å› ä¸ºæˆ‘ä»¬ç›®å‰ä¸èƒ½è¿›è¡ŒæŒ‰å€¼ä¼ å‚. ç»“æ„ä½“å’Œç±»çš„é»˜è®¤æ‹·è´è¡Œä¸ºæ˜¯é€ä¸€æ‹·è´æ‰€æœ‰æ•°æ®æˆå‘˜, å¯¹äº :cpp:`Dynamic_array` è€Œè¨€å°±æ˜¯æ‹·è´ :cpp:`int size_` å’Œ :cpp:`value_type* data_`. ä½†é™¤äº†è¿™ä¸¤ä¸ªæˆå‘˜å¤–, :cpp:`Dynamic_array` è¿˜å…·æœ‰ :cpp:`new[]` æ‰€å¾—æ•°ç»„çš„æ‰€æœ‰æƒ, æ‰€ä»¥æˆ‘ä»¬æ‰å®šä¹‰äº†ææ„å‡½æ•°, ä»è€ŒæŒ‡å‡ºææ„æ—¶è¿™ä¸ªç±»è¦è´Ÿè´£ç”¨ :cpp:`delete[]` é‡Šæ”¾æ•°ç»„.

è¿™æ ·å¯¹ :cpp:`new[]` æ‰€å¾—æ•°ç»„çš„æ‰€æœ‰æƒæ˜¯é€šè¿‡ :cpp:`value_type* data_` æ‰€æŒ‡å‘çš„å¯¹è±¡æ¥è¡¨è¾¾çš„, ä½†é»˜è®¤çš„æ‹·è´è¡Œä¸ºåªæ‹·è´ :cpp:`int size_` å’Œ :cpp:`value_type* data_`, è€ŒæŒ‡é’ˆ :cpp:`data_` å‘ç”Ÿæ‹·è´æ‰€å¾—æ–°æŒ‡é’ˆä¸åŸæŒ‡é’ˆå­˜å‚¨åŒæ ·çš„åœ°å€ã€æŒ‡å‘åŒä¸€ä¸ªå¯¹è±¡.

å› æ­¤, é»˜è®¤æ‹·è´è¡Œä¸ºä¸‹, æ‹·è´åæ–°å¾—åˆ°çš„ :cpp:`Dynamic_array` å¯¹è±¡ä¸åŸå¯¹è±¡å…·æœ‰åŒä¸€ä¸ªæ•°ç»„çš„æ‰€æœ‰æƒ, æ•°ç»„å°†ä¼šè¢«é‡Šæ”¾ä¸¤æ¬¡:

.. code-block:: cpp
  :linenos:

  void print(Dynamic_array parameter) {
    // é€šè¿‡æ‹·è´å¾—åˆ°çš„å½¢å¼å‚æ•° parameter ä¸å®é™…å‚æ•°å…·æœ‰åŒä¸€ä¸ªæ•°ç»„çš„æ‰€æœ‰æƒ
    /* ... */
  }  // å‚æ•°å‘ç”Ÿææ„, é‡Šæ”¾æ•°ç»„

  int main() {
    Dynamic_array array(5);

    print(array);  // ä¼ å…¥å®é™…å‚æ•°, ç›¸å½“äº Dynamic_array parameter = array;

    array[0] = 1;  // é”™è¯¯: è®¿é—®å·²ç»è¢«é‡Šæ”¾çš„æ•°ç»„ç©ºé—´
  }  // é”™è¯¯: ææ„æ—¶è°ƒç”¨ delete[] é‡Šæ”¾æ•°ç»„, ä½†è¿™ä¸ªæ•°ç»„æ—©å°±é‡Šæ”¾äº†

æˆ‘ä»¬éœ€è¦è‡ªå®šä¹‰æ‹·è´å‡½æ•°, åœ¨æ‹·è´æ—¶ä¸ä»…æ‹·è´æˆå‘˜ :cpp:`size_` å’Œ :cpp:`data_`, ä¹Ÿå¯¹ :cpp:`new[]` æ‰€å¾—æ•°ç»„è¿›è¡Œæ‹·è´.

.. hint::

  å½“ç±»è‡ªå®šä¹‰äº†æ‹·è´å‡½æ•°æˆ–ææ„å‡½æ•°, å¾€å¾€æ„å‘³ç€æˆ‘ä»¬åœ¨ç®¡ç†æŸç§ç‰¹æ®Šèµ„æº; è€Œåœ¨ç®¡ç†ç‰¹æ®Šèµ„æºæ—¶, é»˜è®¤çš„æ‹·è´è¡Œä¸ºå’Œææ„è¡Œä¸ºå¾€å¾€éƒ½ä¸åˆé€‚, æˆ‘ä»¬åº”è¯¥å®šä¹‰å®ƒä»¬å…¨éƒ¨. è¿™ç§°ä¸º :doc:`/faq/rule_of_350/main`.

ä¸€ç§æ‹·è´æƒ…å†µæ˜¯, æˆ‘ä»¬ç”¨åŸå¯¹è±¡æ„é€ ä¸€ä¸ªæ–°å¯¹è±¡, ä½¿å¾—å·²æœ‰å¯¹è±¡ä¸åŸå¯¹è±¡ç›¸ç­‰, è¿™ç§°ä¸ºæ‹·è´æ„é€ .
  .. code-block:: cpp
    :linenos:

    int value = 0;
    int copy  = value;  // è™½ç„¶æ˜¯ç­‰å·, ä½†è¿™æ˜¯æ„é€ è€Œéèµ‹å€¼

ä¸€ç§æ‹·è´æƒ…å†µæ˜¯, æˆ‘ä»¬ç”¨åŸå¯¹è±¡å¯¹å·²æœ‰å¯¹è±¡èµ‹å€¼, ä½¿å¾—å·²æœ‰å¯¹è±¡ä¸åŸå¯¹è±¡ç›¸ç­‰, è¿™ç§°ä¸ºæ‹·è´èµ‹å€¼.
  .. code-block:: cpp
    :linenos:

    int value = 0;
    int copy;
    copy = value;

æ³¨æ„åˆ°äº†å—? :cpp:`=` æ ¹æ®æƒ…å†µä¸åŒ, å¯èƒ½æ˜¯æ„é€ æˆ–èµ‹å€¼. **è¿™çœŸçš„å¾ˆçƒ¦**, æ‰€ä»¥æˆ‘æ›´å€¾å‘äºç”¨ :cpp:`{}` è¿›è¡Œåˆå§‹åŒ–, åªåœ¨èµ‹å€¼æ—¶ä½¿ç”¨ :cpp:`=`:

.. tabs::

  .. tab:: :cpp:`int`

    .. code-block:: cpp
      :linenos:

      int value{0};  // æˆ– int value{};

      int copy{value};  // æ„é€ 
      copy = value;     // èµ‹å€¼

  .. tab:: æ•°ç»„

    .. code-block:: cpp
      :linenos:

      int array0[3]{1, 2, 3};

      int* array1{new int[10]{1, 2, 3}};

  .. tab:: æˆå‘˜åˆå§‹åŒ–å™¨

    .. code-block:: cpp
      :linenos:

      class Dynamic_array {
       public:
        explicit Dynamic_array(int size = 0)
            : size_{size}, data_{size == 0 ? nullptr : new value_type[size]{}} {}
      };

æœ¬æ–‡ä¹‹åéƒ¨åˆ†æˆ‘å°†é‡‡ç”¨ :cpp:`{}` è¯­æ³•è¿›è¡Œæ„é€ .

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
æ‹·è´æ„é€ å‡½æ•°
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

é’ˆå¯¹ç”¨åŸå¯¹è±¡æ„é€ æ–°å¯¹è±¡çš„æƒ…å†µ, æˆ‘ä»¬å®šä¹‰æ‹·è´æ„é€ å‡½æ•°. æ‹·è´æ„é€ å‡½æ•°ä»¥åŒä¸€ç±»å‹ :cpp:`Dynamic_array` ä¸ºå‚æ•°, ä»ä¸­è¯»å–å†…å®¹ä»¥å¾—åˆ°å†…å®¹çš„æ‹·è´.

è®©æˆ‘ä»¬çœ‹çœ‹è¿™ä¸ªå‚æ•°åº”è¯¥å†™æˆä»€ä¹ˆæ ·å­:

:cpp:`Dynamic_array(Dynamic_array other)`
  æŒ‰å€¼ä¼ å‚? ä¸, æˆ‘ä»¬æ˜¯åœ¨å®šä¹‰æ€ä¹ˆå¯¹ :cpp:`Dynamic_array` è¿›è¡Œæ‹·è´, å¯æŒ‰å€¼ä¼ å‚å°±æ˜¯åœ¨å¯¹ :cpp:`Dynamic_array` è¿›è¡Œæ‹·è´â€¦â€¦æˆ‘ä»¬åœ¨è¯·å±±é‡Œçš„è€å’Œå°šè®²å±±é‡Œæœ‰åº§åº™çš„é€’å½’æ•…äº‹!

:cpp:`Dynamic_array(Dynamic_array& other)`
  ä¸, æˆ‘ä»¬åªæ˜¯æƒ³è¯»å– :cpp:`other` çš„å†…å®¹, è€Œä¸æƒ³ä¿®æ”¹å®ƒçš„å†…å®¹.

:cpp:`Dynamic_array(Dynamic_array* other)`
  ä¸, å¯¹å¯¹è±¡è¿›è¡Œæ‹·è´çš„è¯­æ³•æ˜¯ :cpp:`int value{other}` è€Œä¸æ˜¯ :cpp:`int value{&other}`.

:cpp:`Dynamic_array(Dynamic_array const* other)`
  åŒä¸Š.

æ’é™¤è¿™äº›é€‰é¡¹, æˆ‘ä»¬æœ€ç»ˆç¡®å®šåº”è¯¥ä½¿ç”¨ :cpp:`Dynamic_array(Dynamic_array const& other)`.

åŠ¨æ€æ•°ç»„çš„æ‹·è´æ„é€ å‡½æ•°åˆ†ä¸ºä¸¤éƒ¨åˆ†:

1. æ ¹æ® :cpp:`other` çš„é•¿åº¦, ä¸ºæœ¬æ•°ç»„ä¹Ÿåˆ†é…åŒæ ·é•¿åº¦çš„æ•°ç»„.
2. å°† :cpp:`other` æ•°ç»„çš„å†…å®¹æ‹·è´åˆ°æ–°æ•°ç»„ä¸­.

.. code-block:: cpp
  :linenos:

  class Dynamic_array {
   public:
    // æ‹·è´æ„é€ å‡½æ•°è™½ç„¶ä¹Ÿæ˜¯å•ä¸ªå‚æ•°, ä½†æŒ‰çº¦å®šä¸ç”¨åŠ  explicit
    Dynamic_array(Dynamic_array const& other)
        : size_{other.size_},
          data_{other.size_ == 0 ? nullptr : new value_type[other.size_]{}} {
      for (int i{0}; i < other.size_; ++i) {
        data_[i] = other.data_[i];
      }
    }

    /* ... */
  };

å‡½æ•°ä½“å†…æ˜¯åœ¨å¯¹æ•°ç»„è¿›è¡Œæ‹·è´, å¯¹å§? æˆ‘ä»¬æ¢ç”¨ç»„ä»¶ :cpp:`copy_n`:

.. code-block:: cpp
  :linenos:

  class Dynamic_array {
   public:
    Dynamic_array(Dynamic_array const& other)
        : size_{other.size_},
          data_{other.size_ == 0 ? nullptr : new value_type[other.size_]{}} {
      copy_n(other.data_, other.size_, data_);
    }

    /* ... */
  };

ç­‰ç­‰, æ€ä¹ˆæ„Ÿè§‰æˆå‘˜åˆå§‹åŒ–å™¨éƒ¨åˆ†ä¹Ÿæœ‰ç‚¹çœ¼ç†Ÿ? æˆ‘ä»¬æ¥å¯¹æ¯”çœ‹çœ‹:

.. code-block:: cpp
  :linenos:
  :emphasize-lines: 4-5, 8-9

  class Dynamic_array {
   public:
    explicit Dynamic_array(int size = 0)
        : size_{size},
          data_{size == 0 ? nullptr : new value_type[size]{}} {}

    Dynamic_array(Dynamic_array const& other)
        : size_{other.size_},
          data_{other.size_ == 0 ? nullptr : new value_type[other.size_]{}} {
      copy_n(other.data_, other.size_, data_);
    }

    /* ... */
  };

æˆ‘ä»¬å¯ä»¥å¹²è„†å§”æ‰˜ :cpp:`Dynamic_array(int size)` æ¥åˆ†é…åˆé€‚é•¿åº¦çš„æ•°ç»„:

.. code-block:: cpp
  :linenos:
  :emphasize-lines: 7

  class Dynamic_array {
   public:
    explicit Dynamic_array(int size = 0)
        : size_{size},
          data_{size == 0 ? nullptr : new value_type[size]{}} {}

    Dynamic_array(Dynamic_array const& other) : Dynamic_array{other.size_} {
      copy_n(other.data_, other.size_, data_);
    }

    /* ... */
  };

æœ€ç»ˆå¾—åˆ°: :godbolt:`44964Wrah`

.. seealso::

  - :doc:`/faq/basic_concepts/function_parameter` ä¸­åˆ†æäº†å„ç§ä¼ å‚æ–¹å¼çš„ç”¨é€”, å¹¶ç»™å‡ºäº†ä¸€ä¸ªæ³›ç”¨ç­–ç•¥.
  - :doc:`/faq/copy_functions_parameter/main` ä¸­ä»‹ç»äº†ä½¿ç”¨ :cpp:`Dynamic_array const&` è€Œé :cpp:`Dynamic_array&` çš„å¦ä¸€ä¸ªåŸå› .

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
æ‹·è´èµ‹å€¼å‡½æ•°
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

é™¤äº†ç”¨åŸå¯¹è±¡æ„é€ æ–°å¯¹è±¡çš„æƒ…å†µå¤–, æˆ‘ä»¬è¿˜å¯èƒ½ç”¨åŸå¯¹è±¡å¯¹å·²æœ‰å¯¹è±¡è¿›è¡Œèµ‹å€¼, ä¸ºæ­¤éœ€è¦å®šä¹‰æ‹·è´èµ‹å€¼å‡½æ•°.

ä½†æ˜¯æˆ‘ä»¬å·²ç»å®šä¹‰äº†å¦‚ä½•æ‹·è´æ„é€ , åˆ™é€šè¿‡æ—§å¯¹è±¡ :cpp:`other` å¯ä»¥æ‹·è´å¾—åˆ°ä¸€ä¸ªæ–°å¯¹è±¡, é‚£ä¹ˆå¦‚æœæˆ‘ä»¬èƒ½äº¤æ¢è¿™ä¸ªæ–°å¯¹è±¡å’Œå·²æœ‰å¯¹è±¡çš„å†…å®¹, å²‚ä¸æ˜¯è¯´å·²æœ‰å¯¹è±¡å°±æ˜¯ :cpp:`other` çš„æ‹·è´äº†?

.. code-block:: cpp
  :linenos:

  Dynamic_array other{/*...*/};

  Dynamic_array å·²æœ‰å¯¹è±¡;

  Dynamic_array copy{other};
  /* äº¤æ¢å·²æœ‰å¯¹è±¡å’Œ copy çš„å†…å®¹ */

  // æ­¤å, å·²æœ‰å¯¹è±¡å°±æ˜¯ other çš„æ‹·è´

ä¸ºæ­¤æˆ‘ä»¬éœ€è¦å®šä¹‰ :cpp:`Dynamic_array` å¦‚ä½•è¿›è¡Œäº¤æ¢. æ˜¾ç„¶åªéœ€è¦äº¤æ¢å¯¹è±¡çš„æ‰€æœ‰æˆå‘˜å³å¯:

.. code-block:: cpp
  :linenos:

  class Dynamic_array {
   public:
    void swap(Dynamic_array& other) {
      using std::swap;           // å…ˆ using std::swap;
      swap(size_, other.size_);  // å†ä½¿ç”¨æ²¡æœ‰ä»»ä½•é™å®šçš„ swap
      swap(data_, other.data_);
    }

    /* ... */
  };

äº¤æ¢çš„åŒæ–¹åœ°ä½æ˜¯å¯¹ç­‰çš„, ä½† :cpp:`array.swap(other)` è¿™æ ·çš„è¯­æ³•åˆ™æ˜¾å¾— :cpp:`array` æ˜¯äº¤æ¢çš„ä¸»åŠ¨æ–¹, è¿™å°±æ˜¾å¾—ä¸å¤ªåˆç†, å› æ­¤åº”è¯¥å°† :cpp:`swap` ä½œä¸ºéæˆå‘˜å‡½æ•° :cpp:`swap(lhs, rhs)`. è€Œä¸ºäº†è®¿é—®ç§ç”¨æˆå‘˜, æˆ‘ä»¬å°† :cpp:`swap` å‡½æ•°è®¾ä¸ºå‹å…ƒå‡½æ•°:

.. code-block:: cpp
  :linenos:

  class Dynamic_array {
   public:
    friend void swap(Dynamic_array& lhs, Dynamic_array& rhs) {
      using std::swap;             // å…ˆ using std::swap;
      swap(lhs.size_, rhs.size_);  // å†ä½¿ç”¨æ²¡æœ‰ä»»ä½•é™å®šçš„ swap
      swap(lhs.data_, rhs.data_);
    }

    /* ... */
  };

.. admonition:: åˆ«çœ‹: ä¸ºä»€ä¹ˆè¦å…ˆ :cpp:`using std::swap;`
  :class: dontread, dropdown

  åˆ«äººå†™çš„å‡½æ•°å« :cpp:`print`, ä½ å†™çš„å‡½æ•°ä¹Ÿå« :cpp:`print`, è¿™å¯èƒ½å¼•èµ·å†²çª. C++ ä¸ºæ­¤å°±å¼•å…¥äº†åå­—ç©ºé—´çš„æ¦‚å¿µ, å°†ä»£ç ç”¨åå­—ç©ºé—´åŒ…è£¹èµ·æ¥å°±æ„å‘³ç€å®ƒå±äºè¿™ä¸ªåå­—ç©ºé—´:

  .. code-block:: cpp
    :linenos:

    namespace fc {
      void print() {  // è¿™æ˜¯ FeignClaims çš„è¾“å‡ºå‡½æ•°
        /* ... */
      }
    }

  æ‰€ä»¥ :cpp:`std::swap(lhs, rhs)` è¿™æ ·é™å®šäº†çš„å‡½æ•°è°ƒç”¨å°±æ˜¯è¯´: æˆ‘è¦ä½¿ç”¨ :cpp:`std`, å³æ ‡å‡†åº“åå­—ç©ºé—´é‡Œçš„ :cpp:`swap` å‡½æ•°.

  ä½†åˆ«äººä¹Ÿå¯èƒ½å®šä¹‰ :cpp:`swap` å‡½æ•°, ç”šè‡³ä½ è‡ªå·±å°±åœ¨å®šä¹‰ :cpp:`swap` å‹å…ƒå‡½æ•°. å½“æˆ‘ä»¬ä½¿ç”¨ä¸åŠ é™å®šçš„ :cpp:`swap(lhs, rhs)` æ—¶, å‡½æ•°é™¤äº†æ ¹æ®åå­—ç©ºé—´, è¿˜èƒ½æ ¹æ®å‚æ•°è¢«æ­£ç¡®æŸ¥è¯¢åˆ°.

  ç»¼ä¸Šä¸¤è€…, æˆ‘ä»¬å…ˆç”¨ :cpp:`using std::swap;` å°†æ ‡å‡†åº“ä¸­çš„æ³›ç”¨ :cpp:`swap` å‡½æ•°å¼•å…¥è¿›æ¥, å†ç”¨ä¸åŠ é™å®šçš„ :cpp:`swap` æ˜¯æœ€åˆé€‚çš„: æ—¢èƒ½ä½¿ç”¨å¤§ä¼™ä¸ºè‡ªå·±è®¾è®¡çš„ç±»è‡ªå®šä¹‰çš„ :cpp:`swap` å‡½æ•°, åˆèƒ½ä»¥ :cpp:`std::swap` å‡½æ•°ä½œä¸ºå¤‡é€‰.

  è¿™ä¹Ÿæ˜¯å°† :cpp:`swap` å‡½æ•°å®šä¹‰ä¸ºå‹å…ƒå‡½æ•°çš„ä¸€ä¸ªåŸå› . (å½“ç„¶å…¶å®è¿˜æœ‰å‡ ä¸ªåŸå› , è¿™é‡Œä¸å†è§£é‡Š.)

  äº‹å®ä¸Š, æˆ‘ä»¬å¸¸å†™çš„ :cpp:`using namespace std;` å°±æ˜¯å°†æ•´ä¸ª :cpp:`std` åå­—ç©ºé—´é‡Œçš„å†…å®¹å¼•å…¥è¿›æ¥.

æˆ‘ä»¬äºæ˜¯å°†æ‹·è´èµ‹å€¼å‡½æ•°å®šä¹‰ä¸º: :godbolt:`qb3dqov4v`

.. code-block:: cpp
  :linenos:

  class Dynamic_array {
   public:
    Dynamic_array& operator=(Dynamic_array const& other) {
      Dynamic_array temp{other};  // ç”¨ other æ‹·è´ä¸€ä¸ªæ–°å¯¹è±¡
      swap(*this, temp);          // äº¤æ¢ *this å’Œ temp çš„å†…å®¹
      return *this;
    }  // temp çš„ææ„å‡½æ•°å°†ä¼šæ¸…ç†äº¤æ¢æ¥çš„å†…å®¹

    /* ... */
  };

ä½ åªéœ€è¦å†™å¥½æ‹·è´æ„é€ å‡½æ•°å’Œææ„å‡½æ•°, å°±èƒ½ç›´æ¥å®šä¹‰æ‹·è´èµ‹å€¼å‡½æ•°, è¿™æ ·çš„æ–¹æ³•ç§°ä¸º :doc:`copy-and-swap æƒ¯ç”¨æ³• </faq/copy_functions_parameter/main>`.

========================================================================================================================
é‡è®¾åŠ¨æ€æ•°ç»„çš„é•¿åº¦
========================================================================================================================

æˆ‘ä»¬å¸Œæœ›é€šè¿‡ :cpp:`array.resize(int new_size)` æ¥é‡è®¾æ•°ç»„çš„å¤§å°, ä½†ä¿æŒæ•°ç»„çš„å†…å®¹ä¸å˜:

- å¦‚æœé•¿åº¦å˜é•¿æˆ–ä¸å˜, åŸæ¥ :cpp:`Dynamic_array` ä¸­æ‰€æœ‰å…ƒç´ å†…å®¹ (:cpp:`size_` ä¸ª) å…¨éƒ¨ä¿æŒ, æ–°å…ƒç´ è®¾ä¸º 0.
- å¦‚æœé•¿åº¦å˜çŸ­, åŸæ¥ :cpp:`Dynamic_array` ä¸­å‰ :cpp:`new_size` ä¸ªå…ƒç´ å†…å®¹å…¨éƒ¨ä¿æŒ.

ä¹Ÿå°±æ˜¯è¯´, æˆ‘ä»¬ç”³è¯· :cpp:`new_size` é•¿åº¦çš„æ–°æ•°ç»„, å†å°†åŸæ¥æ•°ç»„ä¸­å‰ :cpp:`min(new_size, size_)` ä¸ªå…ƒç´ æ‹·è´åˆ°æ–°æ•°ç»„ä¸­.

å¯ä»¥å‘ç°, è¿™ä¾æ—§èƒ½æ²¿ç”¨ copy-and-swap çš„é€»è¾‘, åªæ˜¯æ”¹æˆäº† construct-and-swap: :godbolt:`Ys143Kh79`

.. code-block:: cpp
  :linenos:

  #include <algorithm>  // for std::min

  class Dynamic_array {
   public:
    void resize(int new_size) {
      Dynamic_array temp{new_size};
      copy_n(data_, std::min(size_, new_size), temp.data_);

      swap(*this, temp);
    }

    /* ... */
  };

========================================================================================================================
è¿æ¥ä¸¤ä¸ªåŠ¨æ€æ•°ç»„
========================================================================================================================

æ‰€è°“è¿æ¥ä¸¤ä¸ªåŠ¨æ€æ•°ç»„, å³ç”±æ•°ç»„ :cpp:`{0, 1, 2}` å’Œ :cpp:`{2, 3, 4}` å¾—åˆ° :cpp:`{0, 1, 2, 2, 3, 4}`. è¿™å’Œé‡è®¾åŠ¨æ€æ•°ç»„é•¿åº¦çš„é€»è¾‘ååˆ†ç±»ä¼¼, ä½ ç”šè‡³å¯ä»¥å¤ç”¨ :cpp:`resize(int new_size)` æ¥åšåˆ°.

ä½†æ­¤å¤„æˆ‘ä¸æ‰“ç®—å¤ç”¨ :cpp:`resize(int new_size)`, è€Œå‘ä½ å±•ç¤ºç²¾å¿ƒè®¾è®¡çš„ :cpp:`<algorithm>` ç®—æ³•çš„é­…åŠ›.

------------------------------------------------------------------------------------------------------------------------
:cpp:`operator+(lhs, rhs)`
------------------------------------------------------------------------------------------------------------------------

æŒ‰ :cpp:`int` è¡Œä¸º, :cpp:`lhs + rhs` æ˜¯åˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡æ¥ä¿å­˜ç›¸åŠ åçš„ç»“æœ, è€Œ :cpp:`lhs` å’Œ :cpp:`rhs` ä¸å˜, æ‰€ä»¥æˆ‘ä»¬å®ç°çš„ :cpp:`operator+` ä¹Ÿä¸åº”è¯¥ä¿®æ”¹ :cpp:`lhs` å’Œ :cpp:`rhs`.

ä¸ºæ­¤æˆ‘ä»¬å¯ä»¥æŒ‰å€¼ä¼ å‚, ä¹Ÿå¯ä»¥æŒ‰ :cpp:`const&` ä¼ å‚; ä¸ºäº†é¿å…å¯¹å¤§æ•°ç»„è¿›è¡Œæ‹·è´, æˆ‘é€‰æ‹©æŒ‰ :cpp:`const&` ä¼ å‚è€ŒéæŒ‰å€¼ä¼ å‚.

æ¸…æ¥šäº†å‚æ•°çš„é€‰æ‹©, æˆ‘ä»¬å†æ¥çœ‹çœ‹å‡½æ•°çš„å®é™…é€»è¾‘:

1. ç”³è¯·ä¸€ä¸ªåŠ¨æ€æ•°ç»„, å®ƒçš„é•¿åº¦æ˜¯ :cpp:`lhs.size() + rhs.size()`.
2. å°† :cpp:`lhs` å’Œ :cpp:`rhs` çš„å…ƒç´ ä¾æ¬¡æ‹·è´åˆ°æ–°æ•°ç»„ä¸­.

è¿™æ¬¡è¦æ‹·è´ä¸¤ä¸ªæ•°ç»„, æ€»ä¸èƒ½ç”¨ :cpp:`copy_n` äº†å§? â€¦â€¦è¿˜è®°å¾— :cpp:`copy_n` çš„è¿”å›å€¼å—:

.. code-block:: cpp
  :linenos:
  :emphasize-lines: 4

  // å°† [input, input + size) ä»å·¦åˆ°å³æ‹·è´åˆ° [output, output + size) ä¸­
  //
  // è¿”å›å€¼::
  //   è¿”å› output + size, å³å¦‚æœç»§ç»­å¯¹ output è¿›è¡Œæ‹·è´, åº”è¯¥ä½¿ç”¨çš„æŒ‡é’ˆ.
  value_type* copy_n(value_type const* input, int size, value_type* output) {
    for (int i{0}; i < size; ++i) {
      output[i] = input[i];
    }
    return output + size;
  }

"å¦‚æœç»§ç»­å¯¹ output è¿›è¡Œæ‹·è´, åº”è¯¥ä½¿ç”¨çš„æŒ‡é’ˆ": :godbolt:`eE4Mjh45a`

.. code-block:: cpp
  :linenos:
  :emphasize-lines: 7-9

  class Dynamic_array {
   public:
    friend Dynamic_array operator+(Dynamic_array const& lhs,
                                   Dynamic_array const& rhs) {
      Dynamic_array result(lhs.size() + rhs.size());

      value_type* output{&result.data_[0]};
      output = copy_n(lhs.data_, lhs.size_, output);
      output = copy_n(rhs.data_, rhs.size_, output);

      return result;
    }

    /* ... */
  };

------------------------------------------------------------------------------------------------------------------------
:cpp:`operator+=(other)`
------------------------------------------------------------------------------------------------------------------------

:cpp:`self += other` ä¸ä¹‹å‰æ‰€è§çš„ :cpp:`swap` æˆ– :cpp:`operator+` ä¸åŒ, å®ƒçš„å·¦å³å‚æ•°åœ°ä½ä¸æ˜¯å¯¹ç­‰çš„: å½“æˆ‘ä»¬ä½¿ç”¨ :cpp:`operator+=`, æ˜¯è¾¾åˆ°ä¸ :cpp:`operator=` å³èµ‹å€¼è¿ç®—ç¬¦ç±»ä¼¼çš„æ•ˆæœ, æ˜¯å°† :cpp:`other` çš„å†…å®¹æ·»åŠ åˆ° :cpp:`self` ä¸Š. å› æ­¤åº”è¯¥å°† :cpp:`operator+=` å®šä¹‰ä¸ºæˆå‘˜å‡½æ•°.

ä½†æˆ‘ä»¬ä»èƒ½å¤ç”¨ :cpp:`operator+(lhs, rhs)` æ¥å®ç°å®ƒ: :godbolt:`aKxr34esz`

.. code-block:: cpp
  :linenos:

  class Dynamic_array {
   public:
    // â†“ æŒ‰èµ‹å€¼è¿ç®—ç¬¦çš„æƒ¯ä¾‹, è¿”å› *this å¼•ç”¨
    Dynamic_array& operator+=(Dynamic_array const& other) {
      *this = *this + other;
      return *this;
    }

    /* ... */
  };

.. seealso::

  - :doc:`/faq/basic_concepts/operator_overloading` ä¸­å±•ç¤ºäº†å¸¸è§è¿ç®—ç¬¦åƒè¿™æ ·æ¨¡ä»¿ :cpp:`int` çš„è¡Œä¸ºè¿›è¡Œå®ç°çš„ç¤ºä¾‹.

========================================================================================================================
æ¯”è¾ƒåŠ¨æ€æ•°ç»„
========================================================================================================================

æˆ‘ä»¬æ¥ä¸‹æ¥å®šä¹‰åŠ¨æ€æ•°ç»„çš„æ¯”è¾ƒå…³ç³», ä»è€Œå…è®¸ :cpp:`Dynamic_array` è¿›è¡Œ :cpp:`lhs == rhs` å’Œ :cpp:`lhs < rhs` è¿™æ ·çš„æ¯”è¾ƒ.

ä¸ :cpp:`swap` ç±»ä¼¼, æ¯”è¾ƒçš„åŒæ–¹åœ°ä½æ˜¯å¯¹ç­‰çš„, åº”è¯¥å®šä¹‰ä¸ºå‹å…ƒå‡½æ•°.

------------------------------------------------------------------------------------------------------------------------
ç›¸ç­‰æ€§: :cpp:`bool operator==(lhs, rhs)`
------------------------------------------------------------------------------------------------------------------------

ä»€ä¹ˆæ ·çš„ä¸¤ä¸ªåŠ¨æ€æ•°ç»„æ‰æ˜¯ç›¸ç­‰çš„å‘¢? é¦–å…ˆé•¿åº¦è¦ç›¸ç­‰, å…¶æ¬¡ç›¸åŒä¸‹æ ‡ä¸‹çš„å…ƒç´ ä¹Ÿè¦ç›¸ç­‰.

æˆ‘ä»¬åº”è¯¥ä¼ é€’å¼•ç”¨ä¼ å‚è€Œéæ‹·è´ä¼ å‚, ä¸ºä»€ä¹ˆå‘¢? æƒ³ä¸€æƒ³ä»€ä¹ˆå«æ‹·è´: ç”¨åŸå¯¹è±¡æ„é€ /èµ‹å€¼ä¸€ä¸ªå¯¹è±¡, ä½¿å¾—è¯¥å¯¹è±¡ä¸åŸå¯¹è±¡ **ç›¸ç­‰**. ä½†æˆ‘ä»¬ç°åœ¨å°±æ˜¯åœ¨å®šä¹‰ä»€ä¹ˆæ˜¯ç›¸ç­‰, æ²¡å®šä¹‰ä¹‹å‰å‡­ä»€ä¹ˆè¯´æ‹·è´çš„ç»“æœç›¸ç­‰å‘¢? å› æ­¤æˆ‘ä»¬ä¸èƒ½è®©ç›¸ç­‰æ¯”è¾ƒä¾èµ–äºæ‹·è´è¡Œä¸º.

æ‰€ä»¥ç›¸ç­‰æ¯”è¾ƒåº”è¯¥æ˜¯:

.. code-block:: cpp
  :linenos:

  class Dynamic_array {
   public:
    friend bool operator==(Dynamic_array const& lhs, Dynamic_array const& rhs) {
      if (lhs.size() != rhs.size()) {  // é•¿åº¦æ˜¯å¦ç›¸ç­‰
        return false;
      }

      for (int i{0}; i < lhs.size_; ++i) {
        if (lhs.data_[i] != rhs.data_[i]) {  // åŒä¸€ä¸‹æ ‡ä¸‹çš„å…ƒç´ æ˜¯å¦ç›¸ç­‰
          return false;
        }
      }
      return true;
    }

    /* ... */
  };

è‡³äº :cpp:`bool operator!=(lhs, rhs)`, æˆ‘ä»¬å¤ç”¨ :cpp:`operator==`:

.. code-block:: cpp
  :linenos:

  class Dynamic_array {
   public:
    friend bool operator!=(Dynamic_array const& lhs, Dynamic_array const& rhs) {
      return !(lhs == rhs);
    }

    /* ... */
  };

æœ€ç»ˆå¾—åˆ°: :godbolt:`drTPGdsfx`

------------------------------------------------------------------------------------------------------------------------
ç­‰ä»·æ€§ã€ååºå…³ç³»: :cpp:`bool operator<(lhs, rhs)`
------------------------------------------------------------------------------------------------------------------------

åŠ¨æ€æ•°ç»„çš„ååºå…³ç³»é€šå¸¸å®šä¹‰ä¸ºå­—å…¸åº, å³è¯å…¸æ’åˆ—å•è¯çš„é¡ºåº.

å¯¹äº :cpp:`lhs < rhs`:

1. ä»å·¦åˆ°å³ä¾æ¬¡æ¯”è¾ƒå„å…ƒç´ 

   - :cpp:`lhs[i] < rhs[i]`: :cpp:`lhs` æ›´å°, è¿”å› :cpp:`true`.
   - :cpp:`lhs[i] == rhs[i]`: æ¯”è¾ƒä¸‹ä¸€å¯¹å…ƒç´ .
   - :cpp:`lhs[i] > rhs[i]`: :cpp:`rhs` æ›´å°, è¿”å› :cpp:`false`.

2. ç›¸åŒé•¿åº¦éƒ¨åˆ†éƒ½æ¯”è¾ƒå®Œæ¯•

   - :cpp:`lhs.size() < rhs.size()`: è¯´æ˜ :cpp:`lhs` æ˜¯ :cpp:`rhs` çš„å‰ç¼€, æƒ³æƒ³è¯å…¸æ˜¯æ€ä¹ˆæ’åˆ— a å’Œ ab çš„, è¿”å› :cpp:`true`.
   - :cpp:`lhs.size() == rhs.size()`: è¯´æ˜ä¸¤ä¸ªæ•°ç»„ç›¸ç­‰, è¿”å› :cpp:`false`.
   - :cpp:`lhs.size() > rhs.size()`: è¯´æ˜ :cpp:`rhs` æ˜¯ :cpp:`lhs` çš„å‰ç¼€, æƒ³æƒ³è¯å…¸æ˜¯æ€ä¹ˆæ’åˆ— ab å’Œ a çš„, è¿”å› :cpp:`false`.

æ‰€ä»¥å°äºæ¯”è¾ƒåº”è¯¥æ˜¯:

.. code-block:: cpp
  :linenos:

  #include <algorithm>  // for std::min

  class Dynamic_array {
   public:
    friend bool operator<(Dynamic_array const& lhs, Dynamic_array const& rhs) {
      // æ¯”è¾ƒåŒé•¿éƒ¨åˆ†:
      //  - å°äº: lhs æ›´å°, è¿”å› true
      //  - ç­‰äº: æ¯”è¾ƒä¸‹ä¸€ä¸ªå­—ç¬¦
      //  - å¤§äº: rhs æ›´å°, è¿”å› false
      int const min_size{std::min(lhs.size_, rhs.size_)};
      for (int i{0}; i < min_size; ++i) {
        if (lhs.data_[i] < rhs.data_[i]) {
          return true;
        }
        if (lhs.data_[i] > rhs.data_[i]) {
          return false;
        }
      }

      // åŒé•¿éƒ¨åˆ†å·²ç»æ¯”è¾ƒå®Œæ¯•
      //  - lhs.size_ <  rhs.size_: è¯´æ˜ lhs æ˜¯ rhs çš„å‰ç¼€, æƒ³æƒ³è¯å…¸æ˜¯æ€ä¹ˆæ’åˆ— a å’Œ at çš„, è¿”å› true
      //  - lhs.size_ == rhs.size_: ç›¸åŒ, è¿”å› false
      //  - lhs.size_ >  rhs.size_: è¯´æ˜ rhs æ˜¯ lhs çš„å‰ç¼€, æƒ³æƒ³è¯å…¸æ˜¯æ€ä¹ˆæ’åˆ— at å’Œ a çš„, è¿”å› false
      return lhs.size_ < rhs.size_;
    }

    /* ... */
  };

è‡³äº :cpp:`bool operator>(lhs, rhs)` ç­‰æ¯”è¾ƒ, æˆ‘ä»¬å¤ç”¨ :cpp:`operator<`:

.. code-block:: cpp
  :linenos:

  #include <algorithm>  // for std::min

  class Dynamic_array {
   public:
    friend bool operator>(Dynamic_array const& lhs, Dynamic_array const& rhs) {
      return rhs < lhs;
    }
    friend bool operator<=(Dynamic_array const& lhs, Dynamic_array const& rhs) {
      return !(rhs < lhs);
    }
    friend bool operator>=(Dynamic_array const& lhs, Dynamic_array const& rhs) {
      return !(lhs < rhs);
    }

    /* ... */
  };

æœ€ç»ˆå¾—åˆ°: :godbolt:`MMv73G61f`

.. hint::

  å½“ç„¶ :cpp:`<algorithm>` é‡Œä¹Ÿæœ‰ :cpp:`equal`ã€:cpp:`lexicographical_compare`ã€:cpp:`mismatch` ç­‰æ¯”è¾ƒä¸¤èŒƒå›´çš„ç®—æ³•, è¿™é‡Œä¸ºäº†é¿å…è¯´å¾—å¤ªå¤šå°±æ²¡ç”¨äº†.

.. seealso::

  - :doc:`/faq/basic_concepts/operator_overloading` ä¸­å±•ç¤ºäº†å¸¸è§è¿ç®—ç¬¦åƒè¿™æ ·æ¨¡ä»¿ :cpp:`int` çš„è¡Œä¸ºè¿›è¡Œå®ç°çš„ç¤ºä¾‹.

========================================================================================================================
è¾“å‡ºåŠ¨æ€æ•°ç»„
========================================================================================================================

è°ƒç”¨ :cpp:`print` å‡½æ•°å®åœ¨å¤ªéº»çƒ¦äº†, è®©æˆ‘ä»¬çš„åŠ¨æ€æ•°ç»„ä¹Ÿæ”¯æŒ :cpp:`std::cout << value` å§.

è¿™å…¶å®æ²¡ä»€ä¹ˆå¤§ä¸äº†çš„, åªæ˜¯é‡è½½ :cpp:`operator<<(std::ostream& ostream, Dynamic_array const& array)` ç½¢äº†: :godbolt:`5vGqjGsWx`

.. code-block:: cpp
  :linenos:
  :caption: :cpp:`print` å‡½æ•°

  // æŒ‰ [a0, a1, a2, ..., an] çš„å½¢å¼è¾“å‡ºæ•°ç»„
  void print(Dynamic_array const& array) {
    std::cout << '[';
    for (int i{0}; i < array.size(); ++i) {
      std::cout << (i == 0 ? "" : ", ") << array[i];
    }
    std::cout << ']';
    return ostream;
  }

.. code-block:: cpp
  :linenos:
  :caption: é‡è½½è¾“å‡ºè¿ç®—ç¬¦

  #include <ostream>  // for std::ostream

  class Dynamic_array {
   public:
    //     â†“ æŒ‰çº¦å®šè¿”å› ostream çš„å¼•ç”¨
    friend std::ostream& operator<<(std::ostream& ostream,
                                    Dynamic_array const& array) {
      ostream << '[';
      for (int i{0}; i < array.size(); ++i) {
        ostream << (i == 0 ? "" : ", ") << array[i];
      }
      ostream << ']';
      return ostream;
    }

    /* ... */
  };

.. seealso::

  - :doc:`/faq/basic_concepts/operator_overloading` ä¸­å±•ç¤ºäº†å¸¸è§è¿ç®—ç¬¦åƒè¿™æ ·æ¨¡ä»¿ :cpp:`int` çš„è¡Œä¸ºè¿›è¡Œå®ç°çš„ç¤ºä¾‹.

========================================================================================================================
è®©åŠ¨æ€æ•°ç»„èƒ½åŒ…å«å…¶ä»–ç±»å‹çš„æ•°æ®
========================================================================================================================

æˆ‘ä»¬ä¹‹å‰ä½¿ç”¨ :cpp:`using value_type = int;`, ä»è€Œæ·¡åŒ–äº†åŠ¨æ€æ•°ç»„å­˜å‚¨çš„æ•°æ®è€Œä¸“æ³¨äºåŠ¨æ€æ•°ç»„çš„è®¾è®¡. å…¶å®è¿™æ ·åšè¿˜å¸¦æ¥å¦ä¸€ä¸ªå¥½å¤„: æˆ‘ä»¬åªéœ€æ›´æ”¹ :cpp:`using value_type = ...;` ä¸ºå…¶ä»–ç±»å‹, å°±èƒ½è®©åŠ¨æ€æ•°ç»„åŒ…å«å…¶ä»–ç±»å‹çš„æ•°æ®!

.. code-block:: cpp
  :linenos:

  using value_type = double;  // ç°åœ¨, åŠ¨æ€æ•°ç»„å­˜å‚¨çš„æ˜¯ double ç±»å‹æ•°æ®
  // ...

é‚£ä¹ˆå¦‚æœæˆ‘æƒ³è®©åŠ¨æ€æ•°ç»„å­˜å‚¨å­¦ç”Ÿç±»å‘¢?

.. code-block:: cpp
  :linenos:

  struct Student {
    std::string id;
    std::string name;
  };

  using value_type = Student;

ä½†å½“ä½ ç¼–è¯‘ç”Ÿæˆä¼šå‘ç°è¿™æ ·ä¿®æ”¹åä¼šæŠ¥é”™, ä¸ºä»€ä¹ˆå‘¢? å› ä¸ºæˆ‘ä»¬å¯¹ :cpp:`value_type` è¿›è¡Œäº†æ¯”è¾ƒã€è¾“å‡ºç­‰æ“ä½œ, è€Œ :cpp:`Student` å¹¶ä¸æ”¯æŒè¿™äº›æ“ä½œ. ä½ éœ€è¦çœŸæ­£åœ°å»å­¦ä¹  :doc:`è¿ç®—ç¬¦é‡è½½ </faq/basic_concepts/operator_overloading>` å¹¶ä¸º :cpp:`Student` é‡è½½æ¯”è¾ƒè¿ç®—ç¬¦å’Œè¾“å‡ºæ“ä½œç­‰.

========================================================================================================================
æ•´ä¸ªåŠ¨æ€æ•°ç»„ç±»çš„é™„è§£é‡Šä»£ç 
========================================================================================================================

:godbolt:`Yc6e5Pf4M`

========================================================================================================================
æ‰©å±•: è®©åŠ¨æ€æ•°ç»„èƒ½åŒ…å«ä»»ä½•ç±»å‹çš„æ•°æ®
========================================================================================================================

.. admonition:: å‰ç½®å†…å®¹
  :class: precontent

  - :doc:`/faq/basic_concepts/template`

é‚£æœ‰æ²¡æœ‰ä¸€ç§æ–¹æ³•, è®©åŠ¨æ€æ•°ç»„èƒ½åŒ…å«ä»»æ„ç±»å‹çš„æ•°æ®å‘¢? æˆ‘ä»¬ä»£ç é‡Œä¹Ÿè®¸åŒæ—¶éœ€è¦ :cpp:`int` ç±»å‹çš„åŠ¨æ€æ•°ç»„å’Œ :cpp:`double` ç±»å‹çš„åŠ¨æ€æ•°ç»„.

ä¸ºæ­¤æˆ‘ä»¬ä½¿ç”¨ :doc:`æ¨¡æ¿ </faq/basic_concepts/template>`, å®ƒå°†ç±»å‹ä½œä¸ºå‚æ•°, åŸºäºæä¾›çš„å‚æ•°ç”Ÿæˆå¯¹åº”çš„ä»£ç .

.. code-block:: cpp
  :linenos:

  template <typename T>
  struct Dynamic_array {
   public:
    // æ‰€æœ‰çš„ value_type éƒ½æ¢æˆ T, æˆ–è€…:
    using value_type = T;

    /* ... */

   private:
    int size_;
    value_type* data_;
  };

========================================================================================================================
æ‰©å±•: è®©åŠ¨æ€æ•°ç»„æ”¯æŒä¸Šç™¾ç§ç®—æ³•
========================================================================================================================

è§äº :doc:`/faq/range_iterator_and_algorithm/main`.

========================================================================================================================
æ‰©å±•: è®©åŠ¨æ€æ•°ç»„èƒ½å¤Ÿåˆ—è¡¨åˆå§‹åŒ–
========================================================================================================================

æ•°ç»„è¿˜æœ‰ä¸€ä¸ªå¾ˆä¾¿åˆ©çš„ç‰¹æ€§â€”â€”åœ¨åˆå§‹åŒ–æ—¶åˆ—è¡¨åˆå§‹åŒ–å„ä¸ªå…ƒç´ :

.. code-block:: cpp
  :linenos:

  int main() {
    int array[4]{0, 1, 2, 3};  // {0, 1, 2, 3}
  }

æˆ‘ä»¬ä¹Ÿèƒ½è®© :cpp:`Dynamic_array` æ”¯æŒè¿™ç§åŠŸèƒ½, ä¸ºæ­¤éœ€è¦å®šä¹‰ :cpp:`Dynamic_array(std::initializer_list<value_type>)`:

.. code-block:: cpp
  :linenos:

  class Dynamic_array {
   public:
    // è¿™ä¸ªå‡½æ•°å’Œæ‹·è´æ„é€ å‡½æ•°ä¸€æ ·, ä¹Ÿæ˜¯ä¸éœ€è¦åŠ  explicit çš„ç‰¹ä¾‹
    Dynamic_array(std::initializer_list<value_type> init_list)
        : size_{init_list.size()}
          data_{init_list.size() == 0 ? nullptr : new value_type[init_list.size()]} {
      copy_n(init_list.data(), init_list.size(), data_);
    }

    /* ... */
  };

ä½†è¦æ³¨æ„, ä½¿ç”¨ :cpp:`{}` è¿›è¡Œåˆå§‹åŒ–æ—¶ä¼šä¼˜å…ˆè€ƒè™‘ :cpp:`Dynamic_array(std::initializer_list<value_type>)` è€Œéå…¶ä»–åŒæ ·å¯ç”¨çš„æ„é€ å‡½æ•°, å¦‚æœéœ€è¦å…¶ä»–æ„é€ å‡½æ•°, åº”è¯¥åœ¨åˆé€‚æ—¶å€™ä½¿ç”¨ :cpp:`()` è¿›è¡Œåˆå§‹åŒ–: (è¿™å°±æ˜¯ç”Ÿæ´»ğŸ˜­)

.. code-block:: cpp
  :linenos:

  int main() {
    Dynamic_array array0{5};  // {5}
    Dynamic_array array1(5);  // {0, 0, 0, 0, 0}
  }

çŸ¥é“äº†è¿™ä¸€ç‚¹, æˆ‘ä»¬å°±èƒ½å†å§”æ‰˜ :cpp:`Dynamic_array(int size)` åˆ†é…æ•°ç»„:

.. code-block:: cpp
  :linenos:

  class Dynamic_array {
   public:
    Dynamic_array(std::initializer_list<value_type> init_list)
        : Dynamic_array(init_list.size()) {
      copy_n(init_list.data(), init_list.size(), data_);
    }

    Dynamic_array(Dynamic_array const& other) : Dynamic_array(other.size_) {
      copy_n(other.data_, other.size_, data_);
    }

    /* ... */
  };

========================================================================================================================
æ‰©å±•: è®©åŠ¨æ€æ•°ç»„æ”¯æŒé«˜æ•ˆçš„ç§»åŠ¨
========================================================================================================================

å®šä¹‰æ‹·è´å‡½æ•°å, æˆ‘ä»¬ä¸å†èƒ½é«˜æ•ˆåœ°è¿”å›åŠ¨æ€æ•°ç»„:

.. code-block:: cpp
  :linenos:
  :caption: æœªå®šä¹‰æ‹·è´å‡½æ•°æ—¶

  value_type* make_array() {
    value_type* array{new value_type[1000]{}};
    /* ... */
    return array;  // è¿”å›åªéœ€è¦æ‹·è´æŒ‡å‘æ•°ç»„é¦–å…ƒç´ çš„æŒ‡é’ˆ
  }  // å±€éƒ¨å˜é‡ array è¢«ææ„, è¿™æ²¡ä»€ä¹ˆ, å®ƒåªæ˜¯æŒ‡å‘æ•°ç»„é¦–å…ƒç´ çš„æŒ‡é’ˆ

.. code-block:: cpp
  :linenos:
  :caption: å®šä¹‰æ‹·è´å‡½æ•°æ—¶

  Dynamic_array make_array() {
    Dynamic_array array(1000);
    /* ... */
    return array;  // è¿”å›æ—¶æ‹·è´æ•´ä¸ªæ•°ç»„
  }  // å±€éƒ¨å˜é‡ array è¢«ææ„, æˆ‘ä»¬å¹³ç™½æ— æ•…æ‹·è´äº†å®ƒä¸€ä»½ä½œä¸ºè¿”å›, åˆææ„å®ƒæœ¬èº«

å‘ç°äº†å—? å¯¹äºæœ‰çš„æƒ…å†µ (å°¤å…¶æ˜¯å½“æˆ‘ä»¬åœ¨å‡½æ•°å†…æ„é€ äº†åŠ¨æ€æ•°ç»„, ä¸”æƒ³è¦è¿”å›è¿™ä¸ªæ•°ç»„æ—¶), æˆ‘ä»¬åªæƒ³æ‹·è´æŒ‡é’ˆ, ä»è€Œå¤ç”¨è¿™ä¸ªæ•°ç»„. C++11 ä¸ºæ­¤æ·»åŠ äº†ç§»åŠ¨è¯­ä¹‰, å®ƒè¡¨è¾¾å¯¹èµ„æºçš„è½¬ç§»è€Œéå¯¹èµ„æºè¿›è¡Œæ‹·è´.

è¦æƒ³è®©ç±»æ”¯æŒç§»åŠ¨è¯­ä¹‰, æˆ‘ä»¬éœ€è¦å®šä¹‰ç§»åŠ¨æ„é€ å‡½æ•°å’Œç§»åŠ¨èµ‹å€¼å‡½æ•°; ä½†åœ¨å®šä¹‰ä¹‹å‰, è®©æˆ‘ä»¬å­¦ä¹ å¦ä¸€ä¸ªç»„ä»¶å‡½æ•°.

------------------------------------------------------------------------------------------------------------------------
:cpp:`std::exchange` ç»„ä»¶
------------------------------------------------------------------------------------------------------------------------

:cpp:`exchange(object, new_value)` å°† :cpp:`new_value` èµ‹ç»™ :cpp:`object`, å¹¶è¿”å› :cpp:`object` çš„æ—§å€¼:

.. code-block:: cpp
  :linenos:

  #include <utility>  // for std::exchange

  int value = 5;
  std::cout << std::exchange(value, 3);  // è¾“å‡º 5
  std::cout << value;  // è¾“å‡º 3

è¿™è®©æ•°æ®åƒæ˜¯æ°´æµä¸€æ ·, ä»å³è¾¹æµå‘å·¦è¾¹:

.. code-block:: cpp
  :linenos:

  #include <utility>  // for std::exchange

  // value1 == 0, value2 == 1
  int value1 = 0;
  int value2 = 1;

  // è¿”å› 0, value1 == 1, value2 == 2
  std::exchange(value1, std::exchange(value2, 2));

------------------------------------------------------------------------------------------------------------------------
å®šä¹‰ç§»åŠ¨æ„é€ å’Œç§»åŠ¨èµ‹å€¼å‡½æ•°
------------------------------------------------------------------------------------------------------------------------

ç”±æ­¤, æˆ‘ä»¬å¯ä»¥è¿™æ ·å®šä¹‰ç§»åŠ¨æ„é€ å‡½æ•°å’Œç§»åŠ¨èµ‹å€¼å‡½æ•°:

.. code-block:: cpp
  :linenos:

  #include <utility>  // for std::move

  class Dynamic_array {
   public:
    // ç§»åŠ¨æ„é€ å‡½æ•°å°†èµ„æºä» other è½¬ç§»åˆ°æœ¬å¯¹è±¡ä¸­
    //  å› æ­¤å°† other.data_ çš„å€¼èµ‹ç»™ data_, å¹¶å°† other.data_ è®¾ä¸º nullptr
    //  è€Œ other.size_ åŒç†
    Dynamic_array(Dynamic_array&& other)
        : size_{std::exchange(other.size_, 0)},
          data_{std::exchange(other.data_, nullptr)} {}

    // ç”¨å®šä¹‰å¥½çš„ç§»åŠ¨æ„é€ å‡½æ•°ã€ææ„å‡½æ•°æ¥å®ç°ç§»åŠ¨èµ‹å€¼å‡½æ•°
    Dynamic_array& operator=(Dynamic_array&& other) {
      Dynamic_array temp{std::move(other)};  // ç§»åŠ¨æ„é€ 
      swap(*this, temp);
      return *this;
    }
  };

æ­¤å, å½“æˆ‘ä»¬å°†å±€éƒ¨åŠ¨æ€æ•°ç»„å¯¹è±¡ä½œä¸ºè¿”å›å€¼æ—¶, å®ƒå°†è°ƒç”¨ç§»åŠ¨å‡½æ•°è€Œéæ‹·è´å‡½æ•°:

.. code-block:: cpp
  :linenos:

  Dynamic_array make_array() {
    Dynamic_array array(1000);
    /* ... */
    return array;  // è¿”å›æ—¶ç§»åŠ¨æ•´ä¸ªåŠ¨æ€æ•°ç»„
  }  // å±€éƒ¨å˜é‡ array è¢«ææ„, æ²¡äº‹, å®ƒçš„ array.data_ å·²ç»æ˜¯ nullptr äº†
