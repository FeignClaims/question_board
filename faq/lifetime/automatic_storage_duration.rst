************************************************************************************************************************
1. 自动存储周期 (automatic storage duration)
************************************************************************************************************************

========================================================================================================================
说明
========================================================================================================================

对于自动存储周期的对象, 它在运行到它的定义时被构造, 在离开它所在的代码块 (:cpp:`{}` 包括起来的代码) 时被销毁.

.. code-block:: cpp
  :linenos:

  int main() {
    Noisy c1{Info{.ctor = "0", .dtor = "1"}};
  }
  // 最终输出
  // 0: c1 构造
  // 1: c1 析构

如果有多个自动存储周期对象要销毁, 它们将按构造的相反顺序销毁.

.. code-block:: cpp
  :linenos:

  int main() {
    Noisy c1{Info{.ctor = "0", .dtor = "1"}};
    Noisy c2{Info{.ctor = "2", .dtor = "3"}};
  }
  // 最终输出
  // 0: c1 构造
  // 2: c2 构造
  // 3: c2 析构
  // 1: c1 析构

可以引入代码块, 来缩小对象的生命期.

.. code-block:: cpp
  :linenos:

  int main() {
    {
      Noisy c1{Info{.ctor = "0", .dtor = "1"}};
    }
    Noisy c2{Info{.ctor = "2", .dtor = "3"}};
  }
  // 最终输出
  // 0: c1 构造
  // 1: c1 析构
  // 2: c2 构造
  // 3: c2 析构

C 风格数组的元素按下标顺序构造, 按逆序销毁.

.. code-block:: cpp
  :linenos:

  int main() {
    Noisy c1[] = {Noisy{Info{.ctor = "0", .dtor = "1"}},
                  Noisy{Info{.ctor = "2", .dtor = "3"}},
                  Noisy{Info{.ctor = "4", .dtor = "5"}}};
  }
  // 0: 第 0 个元素构造
  // 2: 第 1 个元素构造
  // 4: 第 2 个元素构造
  // 5: 第 2 个元素析构
  // 3: 第 1 个元素析构
  // 1: 第 0 个元素析构

========================================================================================================================
题目
========================================================================================================================

------------------------------------------------------------------------------------------------------------------------
题 1
------------------------------------------------------------------------------------------------------------------------

.. code-block:: cpp
  :linenos:

  int main() {
    Noisy c1{
        Info{.ctor = "c", .copy_ctor = "m", .copy_assign = "l", .dtor = "e"}};

    Noisy c2{
        Info{.ctor = "o", .copy_ctor = "a", .copy_assign = "p", .dtor = "t"}};

    Noisy c3 = c1;

    c3 = c2;
    c3 = c1;
  }

.. admonition:: 点击查看提示
  :class: dropdown
  
  7 个字符. 英语单词 "完成".

.. admonition:: 点击查看答案
  :class: dropdown, solution

  :godbolt:`nxhMWdbf6`, 答案: :cpp:`complete`.

------------------------------------------------------------------------------------------------------------------------
题 2
------------------------------------------------------------------------------------------------------------------------

.. code-block:: cpp
  :linenos:

  int main() {
    {
      {
        Noisy c1{Info{.ctor = "i", .dtor = "r"}};
        {
          Noisy c2{Info{.ctor = "s", .dtor = "_"}};
        }
        Noisy c3{Info{.ctor = "p", .dtor = "a"}};
      }
      Noisy c4{Info{.ctor = "t", .dtor = "i"}};
    }
    Noisy c5{Info{.ctor = "t", .dtor = "d"}};
    Noisy c6{Info{.ctor = "i", .dtor = "e"}};
    Noisy c7{Info{.ctor = "o", .dtor = "n"}};
  }

.. admonition:: 点击查看提示
  :class: dropdown
  
  14 个字符. STL 判断范围是否已经划分.

.. admonition:: 点击查看答案
  :class: dropdown, solution

  :godbolt:`eMETGvnTW`, 答案: :cpp:`is_partitioned`.

------------------------------------------------------------------------------------------------------------------------
题 3
------------------------------------------------------------------------------------------------------------------------

.. code-block:: cpp
  :linenos:

  int main() {
    Derived_noisy c1{
        Info{.ctor = "l", .copy_ctor = "g", .copy_assign = "i", .dtor = "r"},
        Derived_info{
            .ctor = "e", .copy_ctor = "m", .copy_assign = "h", .dtor = "o"}};

    Noisy c2{Info{.ctor = "n", .dtor = "r"}};

    {
      Noisy c3{c1};  // Noisy c3 = c1;
      {
        Noisy c4{Info{.ctor = "t", .dtor = "e"}};
        {
          Noisy c5{Info{.ctor = "h", .dtor = "_"}};
        }
      }
    }
  }

.. admonition:: 点击查看提示
  :class: dropdown

  12 个字符. 超出实现支持的长度限制时使用的标准库异常. 如当新容量大于 :cpp:`std::vector::max_size()` 时, :cpp:`std::vector::reserve` 会抛出此异常.

.. admonition:: 点击查看答案
  :class: dropdown, solution

  :godbolt:`vaxGPEjhf`, 答案: :cpp:`length_error`.